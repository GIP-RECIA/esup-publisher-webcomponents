!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).esupEvaluator={})}(this,(function(t){"use strict";
/**
   * @license
   * Copyright 2019 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   */const e=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,i=Symbol(),o=new Map;class s{constructor(t,e){if(this._$cssResult$=!0,e!==i)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t}get styleSheet(){let t=o.get(this.cssText);return e&&void 0===t&&(o.set(this.cssText,t=new CSSStyleSheet),t.replaceSync(this.cssText)),t}toString(){return this.cssText}}const a=(t,...e)=>{const o=1===t.length?t[0]:e.reduce(((e,i,o)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+t[o+1]),t[0]);return new s(o,i)},r=e?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return(t=>new s("string"==typeof t?t:t+"",i))(e)})(t):t
/**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   */;var n;const l=window.trustedTypes,d=l?l.emptyScript:"",c=window.reactiveElementPolyfillSupport,u={toAttribute(t,e){switch(e){case Boolean:t=t?d:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let i=t;switch(e){case Boolean:i=null!==t;break;case Number:i=null===t?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch(t){i=null}}return i}},h=(t,e)=>e!==t&&(e==e||t==t),p={attribute:!0,type:String,converter:u,reflect:!1,hasChanged:h};class b extends HTMLElement{constructor(){super(),this._$Et=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Ei=null,this.o()}static addInitializer(t){var e;null!==(e=this.l)&&void 0!==e||(this.l=[]),this.l.push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach(((e,i)=>{const o=this._$Eh(i,e);void 0!==o&&(this._$Eu.set(o,i),t.push(o))})),t}static createProperty(t,e=p){if(e.state&&(e.attribute=!1),this.finalize(),this.elementProperties.set(t,e),!e.noAccessor&&!this.prototype.hasOwnProperty(t)){const i="symbol"==typeof t?Symbol():"__"+t,o=this.getPropertyDescriptor(t,i,e);void 0!==o&&Object.defineProperty(this.prototype,t,o)}}static getPropertyDescriptor(t,e,i){return{get(){return this[e]},set(o){const s=this[t];this[e]=o,this.requestUpdate(t,s,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||p}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),this.elementProperties=new Map(t.elementProperties),this._$Eu=new Map,this.hasOwnProperty("properties")){const t=this.properties,e=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const i of e)this.createProperty(i,t[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const t of i)e.unshift(r(t))}else void 0!==t&&e.push(r(t));return e}static _$Eh(t,e){const i=e.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof t?t.toLowerCase():void 0}o(){var t;this._$Ep=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$Em(),this.requestUpdate(),null===(t=this.constructor.l)||void 0===t||t.forEach((t=>t(this)))}addController(t){var e,i;(null!==(e=this._$Eg)&&void 0!==e?e:this._$Eg=[]).push(t),void 0!==this.renderRoot&&this.isConnected&&(null===(i=t.hostConnected)||void 0===i||i.call(t))}removeController(t){var e;null===(e=this._$Eg)||void 0===e||e.splice(this._$Eg.indexOf(t)>>>0,1)}_$Em(){this.constructor.elementProperties.forEach(((t,e)=>{this.hasOwnProperty(e)&&(this._$Et.set(e,this[e]),delete this[e])}))}createRenderRoot(){var t;const i=null!==(t=this.shadowRoot)&&void 0!==t?t:this.attachShadow(this.constructor.shadowRootOptions);return((t,i)=>{e?t.adoptedStyleSheets=i.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet)):i.forEach((e=>{const i=document.createElement("style"),o=window.litNonce;void 0!==o&&i.setAttribute("nonce",o),i.textContent=e.cssText,t.appendChild(i)}))})(i,this.constructor.elementStyles),i}connectedCallback(){var t;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(t=this._$Eg)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostConnected)||void 0===e?void 0:e.call(t)}))}enableUpdating(t){}disconnectedCallback(){var t;null===(t=this._$Eg)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostDisconnected)||void 0===e?void 0:e.call(t)}))}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$ES(t,e,i=p){var o,s;const a=this.constructor._$Eh(t,i);if(void 0!==a&&!0===i.reflect){const r=(null!==(s=null===(o=i.converter)||void 0===o?void 0:o.toAttribute)&&void 0!==s?s:u.toAttribute)(e,i.type);this._$Ei=t,null==r?this.removeAttribute(a):this.setAttribute(a,r),this._$Ei=null}}_$AK(t,e){var i,o,s;const a=this.constructor,r=a._$Eu.get(t);if(void 0!==r&&this._$Ei!==r){const t=a.getPropertyOptions(r),n=t.converter,l=null!==(s=null!==(o=null===(i=n)||void 0===i?void 0:i.fromAttribute)&&void 0!==o?o:"function"==typeof n?n:null)&&void 0!==s?s:u.fromAttribute;this._$Ei=r,this[r]=l(e,t.type),this._$Ei=null}}requestUpdate(t,e,i){let o=!0;void 0!==t&&(((i=i||this.constructor.getPropertyOptions(t)).hasChanged||h)(this[t],e)?(this._$AL.has(t)||this._$AL.set(t,e),!0===i.reflect&&this._$Ei!==t&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(t,i))):o=!1),!this.isUpdatePending&&o&&(this._$Ep=this._$E_())}async _$E_(){this.isUpdatePending=!0;try{await this._$Ep}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Et&&(this._$Et.forEach(((t,e)=>this[e]=t)),this._$Et=void 0);let e=!1;const i=this._$AL;try{e=this.shouldUpdate(i),e?(this.willUpdate(i),null===(t=this._$Eg)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostUpdate)||void 0===e?void 0:e.call(t)})),this.update(i)):this._$EU()}catch(t){throw e=!1,this._$EU(),t}e&&this._$AE(i)}willUpdate(t){}_$AE(t){var e;null===(e=this._$Eg)||void 0===e||e.forEach((t=>{var e;return null===(e=t.hostUpdated)||void 0===e?void 0:e.call(t)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Ep}shouldUpdate(t){return!0}update(t){void 0!==this._$EC&&(this._$EC.forEach(((t,e)=>this._$ES(e,this[e],t))),this._$EC=void 0),this._$EU()}updated(t){}firstUpdated(t){}}
/**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   */
var g;b.finalized=!0,b.elementProperties=new Map,b.elementStyles=[],b.shadowRootOptions={mode:"open"},null==c||c({ReactiveElement:b}),(null!==(n=globalThis.reactiveElementVersions)&&void 0!==n?n:globalThis.reactiveElementVersions=[]).push("1.3.0");const m=globalThis.trustedTypes,f=m?m.createPolicy("lit-html",{createHTML:t=>t}):void 0,v=`lit$${(Math.random()+"").slice(9)}$`,_="?"+v,y=`<${_}>`,w=document,$=(t="")=>w.createComment(t),x=t=>null===t||"object"!=typeof t&&"function"!=typeof t,k=Array.isArray,A=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,S=/-->/g,E=/>/g,T=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,U=/'/g,C=/"/g,P=/^(?:script|style|textarea|title)$/i,j=(t=>(e,...i)=>({_$litType$:t,strings:e,values:i}))(1),L=Symbol.for("lit-noChange"),R=Symbol.for("lit-nothing"),I=new WeakMap,M=w.createTreeWalker(w,129,null,!1),D=(t,e)=>{const i=t.length-1,o=[];let s,a=2===e?"<svg>":"",r=A;for(let e=0;e<i;e++){const i=t[e];let n,l,d=-1,c=0;for(;c<i.length&&(r.lastIndex=c,l=r.exec(i),null!==l);)c=r.lastIndex,r===A?"!--"===l[1]?r=S:void 0!==l[1]?r=E:void 0!==l[2]?(P.test(l[2])&&(s=RegExp("</"+l[2],"g")),r=T):void 0!==l[3]&&(r=T):r===T?">"===l[0]?(r=null!=s?s:A,d=-1):void 0===l[1]?d=-2:(d=r.lastIndex-l[2].length,n=l[1],r=void 0===l[3]?T:'"'===l[3]?C:U):r===C||r===U?r=T:r===S||r===E?r=A:(r=T,s=void 0);const u=r===T&&t[e+1].startsWith("/>")?" ":"";a+=r===A?i+y:d>=0?(o.push(n),i.slice(0,d)+"$lit$"+i.slice(d)+v+u):i+v+(-2===d?(o.push(void 0),e):u)}const n=a+(t[i]||"<?>")+(2===e?"</svg>":"");if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return[void 0!==f?f.createHTML(n):n,o]};class z{constructor({strings:t,_$litType$:e},i){let o;this.parts=[];let s=0,a=0;const r=t.length-1,n=this.parts,[l,d]=D(t,e);if(this.el=z.createElement(l,i),M.currentNode=this.el.content,2===e){const t=this.el.content,e=t.firstChild;e.remove(),t.append(...e.childNodes)}for(;null!==(o=M.nextNode())&&n.length<r;){if(1===o.nodeType){if(o.hasAttributes()){const t=[];for(const e of o.getAttributeNames())if(e.endsWith("$lit$")||e.startsWith(v)){const i=d[a++];if(t.push(e),void 0!==i){const t=o.getAttribute(i.toLowerCase()+"$lit$").split(v),e=/([.?@])?(.*)/.exec(i);n.push({type:1,index:s,name:e[2],strings:t,ctor:"."===e[1]?G:"?"===e[1]?V:"@"===e[1]?B:F})}else n.push({type:6,index:s})}for(const e of t)o.removeAttribute(e)}if(P.test(o.tagName)){const t=o.textContent.split(v),e=t.length-1;if(e>0){o.textContent=m?m.emptyScript:"";for(let i=0;i<e;i++)o.append(t[i],$()),M.nextNode(),n.push({type:2,index:++s});o.append(t[e],$())}}}else if(8===o.nodeType)if(o.data===_)n.push({type:2,index:s});else{let t=-1;for(;-1!==(t=o.data.indexOf(v,t+1));)n.push({type:7,index:s}),t+=v.length-1}s++}}static createElement(t,e){const i=w.createElement("template");return i.innerHTML=t,i}}function q(t,e,i=t,o){var s,a,r,n;if(e===L)return e;let l=void 0!==o?null===(s=i._$Cl)||void 0===s?void 0:s[o]:i._$Cu;const d=x(e)?void 0:e._$litDirective$;return(null==l?void 0:l.constructor)!==d&&(null===(a=null==l?void 0:l._$AO)||void 0===a||a.call(l,!1),void 0===d?l=void 0:(l=new d(t),l._$AT(t,i,o)),void 0!==o?(null!==(r=(n=i)._$Cl)&&void 0!==r?r:n._$Cl=[])[o]=l:i._$Cu=l),void 0!==l&&(e=q(t,l._$AS(t,e.values),l,o)),e}class O{constructor(t,e){this.v=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(t){var e;const{el:{content:i},parts:o}=this._$AD,s=(null!==(e=null==t?void 0:t.creationScope)&&void 0!==e?e:w).importNode(i,!0);M.currentNode=s;let a=M.nextNode(),r=0,n=0,l=o[0];for(;void 0!==l;){if(r===l.index){let e;2===l.type?e=new N(a,a.nextSibling,this,t):1===l.type?e=new l.ctor(a,l.name,l.strings,this,t):6===l.type&&(e=new K(a,this,t)),this.v.push(e),l=o[++n]}r!==(null==l?void 0:l.index)&&(a=M.nextNode(),r++)}return s}m(t){let e=0;for(const i of this.v)void 0!==i&&(void 0!==i.strings?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}}class N{constructor(t,e,i,o){var s;this.type=2,this._$AH=R,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=o,this._$Cg=null===(s=null==o?void 0:o.isConnected)||void 0===s||s}get _$AU(){var t,e;return null!==(e=null===(t=this._$AM)||void 0===t?void 0:t._$AU)&&void 0!==e?e:this._$Cg}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=q(this,t,e),x(t)?t===R||null==t||""===t?(this._$AH!==R&&this._$AR(),this._$AH=R):t!==this._$AH&&t!==L&&this.$(t):void 0!==t._$litType$?this.T(t):void 0!==t.nodeType?this.k(t):(t=>{var e;return k(t)||"function"==typeof(null===(e=t)||void 0===e?void 0:e[Symbol.iterator])})(t)?this.S(t):this.$(t)}A(t,e=this._$AB){return this._$AA.parentNode.insertBefore(t,e)}k(t){this._$AH!==t&&(this._$AR(),this._$AH=this.A(t))}$(t){this._$AH!==R&&x(this._$AH)?this._$AA.nextSibling.data=t:this.k(w.createTextNode(t)),this._$AH=t}T(t){var e;const{values:i,_$litType$:o}=t,s="number"==typeof o?this._$AC(t):(void 0===o.el&&(o.el=z.createElement(o.h,this.options)),o);if((null===(e=this._$AH)||void 0===e?void 0:e._$AD)===s)this._$AH.m(i);else{const t=new O(s,this),e=t.p(this.options);t.m(i),this.k(e),this._$AH=t}}_$AC(t){let e=I.get(t.strings);return void 0===e&&I.set(t.strings,e=new z(t)),e}S(t){k(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,o=0;for(const s of t)o===e.length?e.push(i=new N(this.A($()),this.A($()),this,this.options)):i=e[o],i._$AI(s),o++;o<e.length&&(this._$AR(i&&i._$AB.nextSibling,o),e.length=o)}_$AR(t=this._$AA.nextSibling,e){var i;for(null===(i=this._$AP)||void 0===i||i.call(this,!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){var e;void 0===this._$AM&&(this._$Cg=t,null===(e=this._$AP)||void 0===e||e.call(this,t))}}class F{constructor(t,e,i,o,s){this.type=1,this._$AH=R,this._$AN=void 0,this.element=t,this.name=e,this._$AM=o,this.options=s,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=R}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,i,o){const s=this.strings;let a=!1;if(void 0===s)t=q(this,t,e,0),a=!x(t)||t!==this._$AH&&t!==L,a&&(this._$AH=t);else{const o=t;let r,n;for(t=s[0],r=0;r<s.length-1;r++)n=q(this,o[i+r],e,r),n===L&&(n=this._$AH[r]),a||(a=!x(n)||n!==this._$AH[r]),n===R?t=R:t!==R&&(t+=(null!=n?n:"")+s[r+1]),this._$AH[r]=n}a&&!o&&this.C(t)}C(t){t===R?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=t?t:"")}}class G extends F{constructor(){super(...arguments),this.type=3}C(t){this.element[this.name]=t===R?void 0:t}}const H=m?m.emptyScript:"";class V extends F{constructor(){super(...arguments),this.type=4}C(t){t&&t!==R?this.element.setAttribute(this.name,H):this.element.removeAttribute(this.name)}}class B extends F{constructor(t,e,i,o,s){super(t,e,i,o,s),this.type=5}_$AI(t,e=this){var i;if((t=null!==(i=q(this,t,e,0))&&void 0!==i?i:R)===L)return;const o=this._$AH,s=t===R&&o!==R||t.capture!==o.capture||t.once!==o.once||t.passive!==o.passive,a=t!==R&&(o===R||s);s&&this.element.removeEventListener(this.name,this,o),a&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,i;"function"==typeof this._$AH?this._$AH.call(null!==(i=null===(e=this.options)||void 0===e?void 0:e.host)&&void 0!==i?i:this.element,t):this._$AH.handleEvent(t)}}class K{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){q(this,t)}}const W=window.litHtmlPolyfillSupport;
/**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   */
var X,Q;null==W||W(z,N),(null!==(g=globalThis.litHtmlVersions)&&void 0!==g?g:globalThis.litHtmlVersions=[]).push("2.2.0");class J extends b{constructor(){super(...arguments),this.renderOptions={host:this},this._$Dt=void 0}createRenderRoot(){var t,e;const i=super.createRenderRoot();return null!==(t=(e=this.renderOptions).renderBefore)&&void 0!==t||(e.renderBefore=i.firstChild),i}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Dt=((t,e,i)=>{var o,s;const a=null!==(o=null==i?void 0:i.renderBefore)&&void 0!==o?o:e;let r=a._$litPart$;if(void 0===r){const t=null!==(s=null==i?void 0:i.renderBefore)&&void 0!==s?s:null;a._$litPart$=r=new N(e.insertBefore($(),t),t,void 0,null!=i?i:{})}return r._$AI(t),r})(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),null===(t=this._$Dt)||void 0===t||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),null===(t=this._$Dt)||void 0===t||t.setConnected(!1)}render(){return L}}J.finalized=!0,J._$litElement$=!0,null===(X=globalThis.litElementHydrateSupport)||void 0===X||X.call(globalThis,{LitElement:J});const Y=globalThis.litElementPolyfillSupport;null==Y||Y({LitElement:J}),(null!==(Q=globalThis.litElementVersions)&&void 0!==Q?Q:globalThis.litElementVersions=[]).push("3.2.0");
/**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   */
const Z=1;
/**
   * @license
   * Copyright 2018 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   */
const tt=(t=>(...e)=>({_$litDirective$:t,values:e}))(class extends class{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,i){this._$Ct=t,this._$AM=e,this._$Ci=i}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}{constructor(t){var e;if(super(t),t.type!==Z||"class"!==t.name||(null===(e=t.strings)||void 0===e?void 0:e.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(t){return" "+Object.keys(t).filter((e=>t[e])).join(" ")+" "}update(t,[e]){var i,o;if(void 0===this.et){this.et=new Set,void 0!==t.strings&&(this.st=new Set(t.strings.join(" ").split(/\s/).filter((t=>""!==t))));for(const t in e)e[t]&&!(null===(i=this.st)||void 0===i?void 0:i.has(t))&&this.et.add(t);return this.render(e)}const s=t.element.classList;this.et.forEach((t=>{t in e||(s.remove(t),this.et.delete(t))}));for(const t in e){const i=!!e[t];i===this.et.has(t)||(null===(o=this.st)||void 0===o?void 0:o.has(t))||(i?(s.add(t),this.et.add(t)):(s.remove(t),this.et.delete(t)))}return L}}),et=a`a:focus,a:hover,a:link{text-decoration:none;outline:0}a{color:var(--subject-infos-text-color,#000)}a:focus,a:focus>div,a:hover,a:hover>div{color:var(--subject-infos-focus-text-color,#25b2f3);background-color:var(--subject-infos-focus-background-color,transparent)}.icon{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:inline-block;font-style:normal;font-variant:normal;text-rendering:auto;line-height:1;margin:0 2px;font-family:'Font Awesome 5 Free';font-weight:900}.icon:before{content:'\\f128'}.icon-question{font-family:var(--icon-question-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-question-font-weight,900)}.icon-question:before{content:var(--icon-question-content, '\\f128')}.icon-users{font-family:var(--icon-users-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-users-font-weight,900)}.icon-users:before{content:var(--icon-users-content, '\\f0c0')}.icon-user{font-family:var(--icon-user-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-user-font-weight,900)}.icon-user:before{content:var(--icon-user-content, '\\f007')}[data-tooltip]{position:relative}`,it={fr:{disappear:" n'est plus présent"},en:{disappear:" isn't more present"}};class ot{constructor(t,e){this.labels=t,this.lang=e}mergeLabels(t){Object.keys(t).forEach((e=>{Object.keys(this.labels).includes(e)?Object.keys(t[e]).forEach((i=>{this.labels[e][i]=t[e][i]})):this.labels[e]=t[e]}))}getLabel(t,e){var i;return i=this.labels[this.lang]&&this.labels[this.lang][t]||t,e&&(i=i.replace(/{([^}]+)}/g,(function(t,i){return void 0!==e[i]?e[i]:t}))),i}}class st{constructor(t){this.id=t||"tooltip",this.tooltip=null,this.tooltipClosing=!1}updateToolTip(t){this.tooltip=t.querySelector("#"+this.id),this.tooltipClosing=!1}renderToolTip(t){return t&&t.length>0?j`<div class="tooltip fade bs-tooltip-top" id="${this.id}" role="tooltip" style="display:none" @mouseover="${()=>{this.hideToolTip()}}"><div class="tooltip-arrow"></div><div class="tooltip-inner">${t}</div></div>`:j``}showToolTip(){if(this.tooltip)if(this.tooltipClosing)setTimeout((()=>this.showToolTip()),50);else{this.tooltip.style.display="block",this.tooltip.style.width="max-content",this.tooltip.offsetWidth>=this.tooltip.parentNode.offsetWidth?(this.tooltip.style.left="0px",this.tooltip.style.transform="none"):(this.tooltip.style.left=Math.round(this.tooltip.parentNode.offsetWidth/2)+"px",this.tooltip.style.transform="translateX(-50%)"),this.tooltip.style.top=-(this.tooltip.offsetHeight+1)+"px",this.tooltip.classList.add("show");const t=this.tooltip.querySelector(".tooltip-arrow");t.style.position="absolute",t.style.transform="translateX(-50%)";const e=Math.round(Math.min(this.tooltip.offsetWidth,this.tooltip.parentNode.offsetWidth)/2);t.style.left=e+"px"}}hideToolTip(){this.tooltip&&!this.tooltipClosing&&this.tooltip.classList.contains("show")&&(this.tooltip.classList.remove("show"),this.tooltipClosing=!0,setTimeout((()=>{this.tooltip.style.display="none",this.tooltipClosing=!1}),100))}}const at=a`@charset "UTF-8";/*!
    * Bootstrap v5.1.3 (https://getbootstrap.com/)
    * Copyright 2011-2021 The Bootstrap Authors
    * Copyright 2011-2021 Twitter, Inc.
    * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
    */:root{--bs-blue:#0d6efd;--bs-indigo:#6610f2;--bs-purple:#6f42c1;--bs-pink:#d63384;--bs-red:#dc3545;--bs-orange:#fd7e14;--bs-yellow:#ffc107;--bs-green:#198754;--bs-teal:#20c997;--bs-cyan:#0dcaf0;--bs-white:#fff;--bs-gray:#6c757d;--bs-gray-dark:#343a40;--bs-gray-100:#f8f9fa;--bs-gray-200:#e9ecef;--bs-gray-300:#dee2e6;--bs-gray-400:#ced4da;--bs-gray-500:#adb5bd;--bs-gray-600:#6c757d;--bs-gray-700:#495057;--bs-gray-800:#343a40;--bs-gray-900:#212529;--bs-primary:#0d6efd;--bs-secondary:#6c757d;--bs-success:#198754;--bs-info:#0dcaf0;--bs-warning:#ffc107;--bs-danger:#dc3545;--bs-light:#f8f9fa;--bs-dark:#212529;--bs-primary-rgb:13,110,253;--bs-secondary-rgb:108,117,125;--bs-success-rgb:25,135,84;--bs-info-rgb:13,202,240;--bs-warning-rgb:255,193,7;--bs-danger-rgb:220,53,69;--bs-light-rgb:248,249,250;--bs-dark-rgb:33,37,41;--bs-white-rgb:255,255,255;--bs-black-rgb:0,0,0;--bs-body-color-rgb:33,37,41;--bs-body-bg-rgb:255,255,255;--bs-font-sans-serif:system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans','Liberation Sans',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Noto Color Emoji';--bs-font-monospace:SFMono-Regular,Menlo,Monaco,Consolas,'Liberation Mono','Courier New',monospace;--bs-gradient:linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.15),
      rgba(255, 255, 255, 0)
    );--bs-body-font-family:var(--bs-font-sans-serif);--bs-body-font-size:1rem;--bs-body-font-weight:400;--bs-body-line-height:1.5;--bs-body-color:#212529;--bs-body-bg:#fff}.tooltip{position:absolute;z-index:1080;display:block;margin:0;font-family:var(--bs-font-sans-serif);font-style:normal;font-weight:400;line-height:1.5;text-align:left;text-align:start;text-decoration:none;text-shadow:none;text-transform:none;letter-spacing:normal;word-break:normal;word-spacing:normal;white-space:normal;line-break:auto;font-size:.875rem;word-wrap:break-word;opacity:0}.tooltip.show{opacity:.9}.tooltip .tooltip-arrow{position:absolute;display:block;width:.8rem;height:.4rem}.tooltip .tooltip-arrow::before{position:absolute;content:'';border-color:transparent;border-style:solid}.bs-tooltip-auto[data-popper-placement^=top],.bs-tooltip-top{padding:.4rem 0}.bs-tooltip-auto[data-popper-placement^=top] .tooltip-arrow,.bs-tooltip-top .tooltip-arrow{bottom:0}.bs-tooltip-auto[data-popper-placement^=top] .tooltip-arrow::before,.bs-tooltip-top .tooltip-arrow::before{top:-1px;border-width:.4rem .4rem 0;border-top-color:#000}.bs-tooltip-auto[data-popper-placement^=right],.bs-tooltip-end{padding:0 .4rem}.bs-tooltip-auto[data-popper-placement^=right] .tooltip-arrow,.bs-tooltip-end .tooltip-arrow{left:0;width:.4rem;height:.8rem}.bs-tooltip-auto[data-popper-placement^=right] .tooltip-arrow::before,.bs-tooltip-end .tooltip-arrow::before{right:-1px;border-width:.4rem .4rem .4rem 0;border-right-color:#000}.bs-tooltip-auto[data-popper-placement^=bottom],.bs-tooltip-bottom{padding:.4rem 0}.bs-tooltip-auto[data-popper-placement^=bottom] .tooltip-arrow,.bs-tooltip-bottom .tooltip-arrow{top:0}.bs-tooltip-auto[data-popper-placement^=bottom] .tooltip-arrow::before,.bs-tooltip-bottom .tooltip-arrow::before{bottom:-1px;border-width:0 .4rem .4rem;border-bottom-color:#000}.bs-tooltip-auto[data-popper-placement^=left],.bs-tooltip-start{padding:0 .4rem}.bs-tooltip-auto[data-popper-placement^=left] .tooltip-arrow,.bs-tooltip-start .tooltip-arrow{right:0;width:.4rem;height:.8rem}.bs-tooltip-auto[data-popper-placement^=left] .tooltip-arrow::before,.bs-tooltip-start .tooltip-arrow::before{left:-1px;border-width:.4rem 0 .4rem .4rem;border-left-color:#000}.tooltip-inner{max-width:200px;padding:.25rem .5rem;color:#fff;text-align:center;background-color:#000;border-radius:.25rem}.fade{transition:opacity .15s linear}@media (prefers-reduced-motion:reduce){.fade{transition:none}}.fade:not(.show){opacity:0}`;class rt{static isDefined(t){return void 0!==t}static isArray(t){return Array.isArray(t)||t instanceof Array}}class nt extends J{static get styles(){return[et,at]}static get properties(){return{subject:{attribute:!1},config:{attribute:!1},onSubjectClicked:{attribute:!1}}}constructor(){super(),this._subject=null,this._localization=new ot(it,"fr"),this._tooltip=new st}render(){var t=j``;return this._subject&&("modelId"in this._subject?t=this._htmlFromDTO(this._subject):"keyType"in this._subject&&"keyId"in this._subject?t=this._htmlFromKey(this._subject):"keyValue"in this._subject&&"keyAttribute"in this._subject&&"keyType"in this._subject&&(t=this._htmlFromExtendedKey(this._subject))),j`<div class="subject-infos"><slot></slot>${t}</div>`}willUpdate(t){super.willUpdate(t);let e=!1;t&&(e=t.has("subject")||t.has("config")),e&&(this._localization.labels=it,this._localization.lang=this.config&&this.config.lang?this.config.lang:this._localization.lang,this.config&&this.config.labels&&this._localization.mergeLabels(this.config.labels),!this.config.getSubjectInfos||rt.isDefined(this.config.resolveKey)&&!this.config.resolveKey?this._subject=this.subject:rt.isDefined(this.subject)&&rt.isDefined(this.subject.modelId)&&!rt.isDefined(this.subject.attributes)&&"GROUP"!==this.subject.modelId.keyType?null!==this._subject&&rt.isDefined(this._subject)&&this.subject.modelId.keyType===this._subject.modelId.keyType&&this.subject.modelId.keyId===this._subject.modelId.keyId||this.config.getSubjectInfos(this.subject.modelId.keyType,this.subject.modelId.keyId).then((t=>{this._subject=t,this.requestUpdate()})):rt.isDefined(this.subject)&&"keyType"in this.subject&&"keyId"in this.subject?null!==this._subject&&rt.isDefined(this._subject)&&this.subject.keyType===this._subject.modelId.keyType&&this.subject.keyId===this._subject.modelId.keyId||this.config.getSubjectInfos(this.subject.keyType,this.subject.keyId).then((t=>{this._subject=t,this.requestUpdate()})):this._subject=this.subject)}updated(t){super.updated(t),this._tooltip.updateToolTip(this.shadowRoot)}_htmlFromDTO(t){const e=t.modelId.keyType;if(["PERSON","GROUP"].includes(e)){const i=!0===t.foundOnExternalSource||t.displayName&&t.displayName.length>0,o={"icon-question":!i};return j`<a href="" class="subject-infos ${tt({"icon-users":"GROUP"===e,"icon-user":"PERSON"===e})}" data-subject-id="${t.modelId.keyId}" @click="${t=>this._onClick(t)}"><span class="${tt(o)}" data-tooltip aria-describedby="tooltip" @mouseenter="${()=>this._tooltip.showToolTip()}" @mouseleave="${()=>this._tooltip.hideToolTip()}">${i?t.displayName:""} ${this._tooltip.renderToolTip(this._tooltipSubject(t))}</span></a>`}return j`<span class="icon-question subject-infos"></span>`}_htmlFromKey(t){const e=t.keyType;if(["PERSON","GROUP"].includes(e)){return j`<a href="" class="subject-infos ${tt({"icon-users":"GROUP"===e,"icon-user":"PERSON"===e})}" data-subject-id="${t.keyId}" @click="${t=>this._onClick(t)}"><span class="icon-question" data-tooltip aria-describedby="tooltip" @mouseenter="${()=>this._tooltip.showToolTip()}" @mouseleave="${()=>this._tooltip.hideToolTip()}">${this._tooltip.renderToolTip(this._tooltipSubject(t))}</span></a>`}throw new Error("Subject Type not managed and should not be tested :"+e)}_htmlFromExtendedKey(t){var e=null;const i=t.keyType,o=t.keyValue,s=t.keyAttribute;switch(i){case"GROUP":case"PERSON":e=j`<a href="" class="subject-infos icon-user" data-subject-id="${o}" @click="${t=>this._onClick(t)}"><span class="icon-question" data-tooltip aria-describedby="tooltip" @mouseenter="${()=>this._tooltip.showToolTip()}" @mouseleave="${()=>this._tooltip.hideToolTip()}">${this._tooltip.renderToolTip(this._tooltipSubject(t))}</span></a>`;break;case"PERSON_ATTR":case"PERSON_ATTR_REGEX":e=j`<span class="subject-infos icon-users" data-subject-id="${o}">${s+' = "'+o+'"'}</span>`;break;default:throw new Error("Subject Type not managed :"+i)}return e}_onClick(t){t.preventDefault(),t.stopPropagation(),this.onSubjectClicked&&this.onSubjectClicked()}_tooltipSubject(t){const e=this.config.userDisplayedAttrs||[];if(!rt.isDefined(e)||!rt.isDefined(t))return"";if(rt.isDefined(t.keyId))return"'"+t.keyId+"'"+this._localization.getLabel("disappear");if(!rt.isDefined(t.modelId))return"";if(rt.isDefined(t.modelId)&&!0!==t.foundOnExternalSource)return"'"+t.modelId.keyId+"'"+this._localization.getLabel("disappear");if("GROUP"===t.modelId.keyType)return t.modelId.keyId;if(!rt.isDefined(t.attributes))return t.modelId.keyId;var i,o=t.attributes,s="";for(i=0;i<e.length;++i){var a;if(i>0&&rt.isDefined(o[e[i]])&&""!==s&&(s+=" - "),rt.isDefined(o[e[i]])&&Array.isArray(o[e[i]]))for(a=0;a<o[e[i]].length;++a)a>0&&(s+=", "),s+=o[e[i]][a];else rt.isDefined(o[e[i]])&&(s+=o[e[i]])}return s}}customElements.get("esup-subject-infos")||customElements.define("esup-subject-infos",nt);const lt=a`.icon{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:inline-block;font-style:normal;font-variant:normal;text-rendering:auto;line-height:1;margin:0 2px}.icon-plus{font-family:var(--icon-plus-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-plus-font-weight,900)}.icon-plus:before{content:var(--icon-plus-content, '\\f067')}.icon-cancel{font-family:var(--icon-cancel-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-cancel-font-weight,900)}.icon-cancel:before{content:var(--icon-cancel-content, '\\f05e')}.icon-validate{font-family:var(--icon-validate-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-validate-font-weight,900)}.icon-validate:before{content:var(--icon-validate-content, '\\f019')}.icon-question{font-family:var(--icon-question-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-question-font-weight,900)}.icon-question:before{content:var(--icon-question-content, '\\f059')}.icon-search{font-family:var(--icon-search-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-search-font-weight,900)}.icon-search:before{content:var(--icon-search-content, '\\f002')}ul.pagination li .page-link,ul.pagination li.disabled .page-link{color:var(--text-color-pagination,#25b2f3);border-color:#d0d0d0}ul.pagination li.page-item.active .page-link{color:var(--selected-text-color-pagination,#fff);background-color:var(--selected-background-color-pagination,#25b2f3);border-color:#d0d0d0}.page-item.disabled,button:disabled{cursor:not-allowed;pointer-events:all!important}button.btn-primary.validate{color:var(--validate-button-text-color,#fff);background-color:var(--validate-button-background-color,#0d6efd);border-color:var(--validate-button-border-color,#0d6efd)}button.btn-primary.validate:not(:disabled):hover{opacity:.75}[data-tooltip]{position:relative}`,dt={fr:{"type.group":"Groupe","type.user":"Personne","type.userfromgroup":"Personne d'un groupe","type.userfromattr":"Valeur d'un attribut utilisateur","type.userfromregexattr":"Expression régulière sur un attribut utilisateur",cancel:"Annuler",validate:"Valider","search.targets.group":"Recherche d'un groupe","search.targets.user":"Recherche d'un utilisateur","search.targets.userFromGroup":"Recherche d'un utilisateur à partir d'un groupe","search.targets.userAttrs":"Définition d'une valeur vérifiant un attribut utilisateur","search.targets.userRegexAttr":"Définition d'une expression régulière vérifiant une valeur d'un attribut utilisateur","user.search.label":"Rechercher un utilisateur","user.search.desc":"Recherche sous la forme : NOM Prénom, sans accent, saisissez un maximum de caractères, 3 caractères minimum","user.search.placeholder":"Recherche...","filter.label":"Filtre :","filter.placeholder":"filtre","pager.nbItems":"Nb items par page :","userFromGroup.label":"Cliquez sur un groupe pour en sélectionner les membres : ","userAttr.attribute.label":"Attribut utilisateur","userAttr.value.label":"Valeur de l'attribut","userRegexAttr.attribute.label":"Attribut utilisateur","userRegexAttr.value.label":"Expression régulière"},en:{"type.group":"Group","type.user":"Person","type.userfromgroup":"Person from group","type.userfromattr":"Person with an attribute value","type.userfromregexattr":"Person with an attribute matching a regular expression",cancel:"Cancel",validate:"Ok","search.targets.group":"Search on group","search.targets.user":"Search on user","search.targets.userFromGroup":"Search on user from group","search.targets.userAttrs":"Setting a value that will match a user attribute","search.targets.userRegexAttr":"Setting a regular expression matching the value of a user attribute","user.search.label":"Search a person","user.search.desc":"Search style : NAME Firstname, without accent, enter the maximum of characters, 3 characters minimum","user.search.placeholder":"Search...","filter.label":"Filter :","filter.placeholder":"filter","pager.nbItems":"Nb items per page :","userFromGroup.label":"Select a group to see members: ","userAttr.attribute.label":"User's attribute","userAttr.value.label":"Attribute's value","userRegexAttr.attribute.label":"User's attribute","userRegexAttr.value.label":"Regular expression"}},ct=a`@charset "UTF-8";/*!
    * Bootstrap v5.1.3 (https://getbootstrap.com/)
    * Copyright 2011-2021 The Bootstrap Authors
    * Copyright 2011-2021 Twitter, Inc.
    * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
    */*,::after,::before{box-sizing:border-box}.h4,h4{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}.h4,h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){.h4,h4{font-size:1.5rem}}ul{padding-left:2rem;margin-top:0;margin-bottom:1rem}ul ul{margin-bottom:0}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[type=button],button{-webkit-appearance:button}[type=button]:not(:disabled),button:not(:disabled){cursor:pointer}[hidden]{display:none!important}.list-unstyled{padding-left:0;list-style:none}.row{--bs-gutter-x:1.5rem;--bs-gutter-y:0;display:flex;flex-wrap:wrap;margin-top:calc(-1 * var(--bs-gutter-y));margin-right:calc(-.5 * var(--bs-gutter-x));margin-left:calc(-.5 * var(--bs-gutter-x))}.row>*{flex-shrink:0;width:100%;max-width:100%;padding-right:calc(var(--bs-gutter-x) * .5);padding-left:calc(var(--bs-gutter-x) * .5);margin-top:var(--bs-gutter-y)}.col-auto{flex:0 0 auto;width:auto}.g-3{--bs-gutter-x:1rem;--bs-gutter-y:1rem}.form-label{margin-bottom:.5rem}.col-form-label{padding-top:calc(.375rem + 1px);padding-bottom:calc(.375rem + 1px);margin-bottom:0;font-size:inherit;line-height:1.5}.form-control{display:block;width:100%;padding:.375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;background-clip:padding-box;border:1px solid #ced4da;-webkit-appearance:none;-moz-appearance:none;appearance:none;border-radius:.25rem;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media (prefers-reduced-motion:reduce){.form-control{transition:none}}.form-control:focus{color:#212529;background-color:#fff;border-color:#86b7fe;outline:0;box-shadow:0 0 0 .25rem rgba(13,110,253,.25)}.form-control::-moz-placeholder{color:#6c757d;opacity:1}.form-control::placeholder{color:#6c757d;opacity:1}.form-control:disabled,.form-control[readonly]{background-color:#e9ecef;opacity:1}.form-select{display:block;width:100%;padding:.375rem 2.25rem .375rem .75rem;-moz-padding-start:calc(.75rem - 3px);font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");background-repeat:no-repeat;background-position:right .75rem center;background-size:16px 12px;border:1px solid #ced4da;border-radius:.25rem;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out;-webkit-appearance:none;-moz-appearance:none;appearance:none}@media (prefers-reduced-motion:reduce){.form-select{transition:none}}.form-select:focus{border-color:#86b7fe;outline:0;box-shadow:0 0 0 .25rem rgba(13,110,253,.25)}.form-select[multiple],.form-select[size]:not([size='1']){padding-right:.75rem;background-image:none}.form-select:disabled{background-color:#e9ecef}.form-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #212529}.input-group{position:relative;display:flex;flex-wrap:wrap;align-items:stretch;width:100%}.input-group>.form-control{position:relative;flex:1 1 auto;width:1%;min-width:0}.input-group>.form-control:focus{z-index:3}.input-group .btn{position:relative;z-index:2}.input-group .btn:focus{z-index:3}.input-group:not(.has-validation)>.dropdown-toggle:nth-last-child(n+3),.input-group:not(.has-validation)>:not(:last-child):not(.dropdown-toggle):not(.dropdown-menu){border-top-right-radius:0;border-bottom-right-radius:0}.input-group.has-validation>.dropdown-toggle:nth-last-child(n + 4),.input-group.has-validation>:nth-last-child(n+3):not(.dropdown-toggle):not(.dropdown-menu){border-top-right-radius:0;border-bottom-right-radius:0}.input-group>:not(:first-child):not(.dropdown-menu):not(.valid-tooltip):not(.valid-feedback):not(.invalid-tooltip):not(.invalid-feedback){margin-left:-1px;border-top-left-radius:0;border-bottom-left-radius:0}.btn{display:inline-block;font-weight:400;line-height:1.5;color:#212529;text-align:center;text-decoration:none;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;border-radius:.25rem;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media (prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529}.btn:focus{outline:0;box-shadow:0 0 0 .25rem rgba(13,110,253,.25)}.btn.disabled,.btn:disabled{pointer-events:none;opacity:.65}.btn-primary{color:#fff;background-color:#0d6efd;border-color:#0d6efd}.btn-primary:hover{color:#fff;background-color:#0b5ed7;border-color:#0a58ca}.btn-primary:focus{color:#fff;background-color:#0b5ed7;border-color:#0a58ca;box-shadow:0 0 0 .25rem rgba(49,132,253,.5)}.btn-primary.active,.btn-primary:active,.show>.btn-primary.dropdown-toggle{color:#fff;background-color:#0a58ca;border-color:#0a53be}.btn-primary.active:focus,.btn-primary:active:focus,.show>.btn-primary.dropdown-toggle:focus{box-shadow:0 0 0 .25rem rgba(49,132,253,.5)}.btn-primary.disabled,.btn-primary:disabled{color:#fff;background-color:#0d6efd;border-color:#0d6efd}.btn-outline-secondary{color:#6c757d;border-color:#6c757d}.btn-outline-secondary:hover{color:#fff;background-color:#6c757d;border-color:#6c757d}.btn-outline-secondary:focus{box-shadow:0 0 0 .25rem rgba(108,117,125,.5)}.btn-outline-secondary.active,.btn-outline-secondary.dropdown-toggle.show,.btn-outline-secondary:active{color:#fff;background-color:#6c757d;border-color:#6c757d}.btn-outline-secondary.active:focus,.btn-outline-secondary.dropdown-toggle.show:focus,.btn-outline-secondary:active:focus{box-shadow:0 0 0 .25rem rgba(108,117,125,.5)}.btn-outline-secondary.disabled,.btn-outline-secondary:disabled{color:#6c757d;background-color:transparent}.btn-outline-dark{color:#212529;border-color:#212529}.btn-outline-dark:hover{color:#fff;background-color:#212529;border-color:#212529}.btn-check:focus+.btn-outline-dark,.btn-outline-dark:focus{box-shadow:0 0 0 .25rem rgba(33,37,41,.5)}.btn-check:active+.btn-outline-dark,.btn-check:checked+.btn-outline-dark,.btn-outline-dark.active,.btn-outline-dark.dropdown-toggle.show,.btn-outline-dark:active{color:#fff;background-color:#212529;border-color:#212529}.btn-check:active+.btn-outline-dark:focus,.btn-check:checked+.btn-outline-dark:focus,.btn-outline-dark.active:focus,.btn-outline-dark.dropdown-toggle.show:focus,.btn-outline-dark:active:focus{box-shadow:0 0 0 .25rem rgba(33,37,41,.5)}.btn-outline-dark.disabled,.btn-outline-dark:disabled{color:#212529;background-color:transparent}.fade{transition:opacity .15s linear}@media (prefers-reduced-motion:reduce){.fade{transition:none}}.fade:not(.show){opacity:0}.collapse:not(.show){display:none}.collapsing{height:0;overflow:hidden;transition:height .35s ease}@media (prefers-reduced-motion:reduce){.collapsing{transition:none}}.collapsing.collapse-horizontal{width:0;height:auto;transition:width .35s ease}@media (prefers-reduced-motion:reduce){.collapsing.collapse-horizontal{transition:none}}.btn-group{position:relative;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;flex:1 1 auto}.btn-group>.btn-check:checked+.btn,.btn-group>.btn-check:focus+.btn,.btn-group>.btn.active,.btn-group>.btn:active,.btn-group>.btn:focus,.btn-group>.btn:hover{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn,.btn-group>.btn:not(:last-child):not(.dropdown-toggle){border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:nth-child(n+3),.btn-group>:not(.btn-check)+.btn{border-top-left-radius:0;border-bottom-left-radius:0}.card{position:relative;display:flex;flex-direction:column;min-width:0;word-wrap:break-word;background-color:#fff;background-clip:border-box;border:1px solid rgba(0,0,0,.125);border-radius:.25rem}.card-body{flex:1 1 auto;padding:1rem 1rem}.card-header{padding:.5rem 1rem;margin-bottom:0;background-color:rgba(0,0,0,.03);border-bottom:1px solid rgba(0,0,0,.125)}.card-header:first-child{border-radius:calc(.25rem - 1px) calc(.25rem - 1px) 0 0}.card-footer{padding:.5rem 1rem;background-color:rgba(0,0,0,.03);border-top:1px solid rgba(0,0,0,.125)}.card-footer:last-child{border-radius:0 0 calc(.25rem - 1px) calc(.25rem - 1px)}.pagination{display:flex;padding-left:0;list-style:none}.page-link{position:relative;display:block;color:#0d6efd;text-decoration:none;background-color:#fff;border:1px solid #dee2e6;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media (prefers-reduced-motion:reduce){.page-link{transition:none}}.page-link:hover{z-index:2;color:#0a58ca;background-color:#e9ecef;border-color:#dee2e6}.page-link:focus{z-index:3;color:#0a58ca;background-color:#e9ecef;outline:0}.page-item:not(:first-child) .page-link{margin-left:-1px}.page-item.active .page-link{z-index:3;color:#fff;background-color:#0d6efd;border-color:#0d6efd}.page-item.disabled .page-link{color:#6c757d;pointer-events:none;background-color:#fff;border-color:#dee2e6}.page-link{padding:.375rem .75rem}.page-item:first-child .page-link{border-top-left-radius:.25rem;border-bottom-left-radius:.25rem}.page-item:last-child .page-link{border-top-right-radius:.25rem;border-bottom-right-radius:.25rem}.btn-close{box-sizing:content-box;width:1em;height:1em;padding:.25em .25em;color:#000;background:transparent url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23000'%3e%3cpath d='M.293.293a1 1 0 011.414 0L8 6.586 14.293.293a1 1 0 111.414 1.414L9.414 8l6.293 6.293a1 1 0 01-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 01-1.414-1.414L6.586 8 .293 1.707a1 1 0 010-1.414z'/%3e%3c/svg%3e") center/1em auto no-repeat;border:0;border-radius:.25rem;opacity:.5}.btn-close:hover{color:#000;text-decoration:none;opacity:.75}.btn-close:focus{outline:0;box-shadow:0 0 0 .25rem rgba(13,110,253,.25);opacity:1}.btn-close.disabled,.btn-close:disabled{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;opacity:.25}.modal{position:fixed;top:0;left:0;z-index:1055;display:none;width:100%;height:100%;overflow-x:hidden;overflow-y:auto;outline:0}.modal-dialog{position:relative;width:auto;margin:.5rem;pointer-events:none}.modal.fade .modal-dialog{transition:transform .3s ease-out;transform:translate(0,-50px)}@media (prefers-reduced-motion:reduce){.modal.fade .modal-dialog{transition:none}}.modal.show .modal-dialog{transform:none}.modal-content{position:relative;display:flex;flex-direction:column;width:100%;pointer-events:auto;background-color:#fff;background-clip:padding-box;border:1px solid rgba(0,0,0,.2);border-radius:.3rem;outline:0}.modal-backdrop{position:fixed;top:0;left:0;z-index:1050;width:100vw;height:100vh;background-color:#000}.modal-backdrop.fade{opacity:0}.modal-backdrop.show{opacity:.5}.modal-header{display:flex;flex-shrink:0;align-items:center;justify-content:space-between;padding:1rem 1rem;border-bottom:1px solid #dee2e6;border-top-left-radius:calc(.3rem - 1px);border-top-right-radius:calc(.3rem - 1px)}.modal-header .btn-close{padding:.5rem .5rem;margin:-.5rem -.5rem -.5rem auto}.modal-title{margin-bottom:0;line-height:1.5}.modal-body{position:relative;flex:1 1 auto;padding:1rem}.modal-footer{display:flex;flex-wrap:wrap;flex-shrink:0;align-items:center;justify-content:flex-end;padding:.75rem;border-top:1px solid #dee2e6;border-bottom-right-radius:calc(.3rem - 1px);border-bottom-left-radius:calc(.3rem - 1px)}.modal-footer>*{margin:.25rem}@media (min-width:576px){.modal-dialog{max-width:500px;margin:1.75rem auto}}@media (min-width:992px){.modal-lg{max-width:800px}}.align-items-center{align-items:center!important}.fw-bold{font-weight:700!important}.mt-2{margin-top:.5rem!important}.mt-3{margin-top:1rem!important}`,ut=a`.root-tree{padding-left:0;margin-left:1px;margin-right:1px;--min-dimension:var(--min-clickable-dimension, 24px)}.root-tree li{list-style-type:none}.root-tree .row-data:focus,.root-tree .row-data:hover{color:var(--hover-text-color,#000)}.root-tree .row-data.jstree-clicked,.root-tree .row-data.jstree-clicked span{background-color:var(--selected-background-color,transparent);color:var(--selected-text-color,#000)}.root-tree .row,.root-tree .row-data{display:inline-block;min-height:var(--min-dimension);min-width:var(--min-dimension)}.root-tree .row-data span{margin-right:3px;margin-left:3px}.root-tree .subtree{display:none}.root-tree .subtree-active{display:block}.row{width:calc(100% - var(--min-dimension));cursor:pointer;position:relative;padding-top:1px;padding-bottom:1px;padding-right:1px;padding-left:var(--min-dimension)}.align-items-center{align-items:center!important}.d-flex{display:flex!important}.icon-indicator{left:calc(var(--min-dimension)/ 2);position:absolute;top:50%;transform:translateY(-50%) translateX(-50%)}.row-data{width:100%}i.icon{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:inline-block;font-style:normal;font-variant:normal;text-rendering:auto;line-height:1;margin:0 2px;font-family:var(--icon-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-font-weight,900)}i.icon:before{content:var(--icon-content, '\\f07b')}.item-subtree>div>.icon-indicator{font-family:var(--icon-fold-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-fold-font-weight,900)}.item-subtree>div>.icon-indicator:before{content:var(--icon-fold-content, '\\f0da')}.item-active>div>.icon-indicator{font-family:var(--icon-unfold-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-unfold-font-weight,900)}.item-active>div>.icon-indicator:before{content:var(--icon-unfold-content, '\\f0d7')}i.icon-0{font-family:var(--icon-0-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-0-font-weight,900)}i.icon-0:before{content:var(--icon-0-content, '\\f07b')}i.icon-1{font-family:var(--icon-1-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-1-font-weight,900)}i.icon-1:before{content:var(--icon-1-content, '\\f07b')}i.icon-2{font-family:var(--icon-2-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-2-font-weight,900)}i.icon-2:before{content:var(--icon-2-content, '\\f07b')}i.icon-3{font-family:var(--icon-3-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-3-font-weight,900)}i.icon-3:before{content:var(--icon-3-content, '\\f07b')}i.icon-4{font-family:var(--icon-4-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-4-font-weight,900)}i.icon-4:before{content:var(--icon-4-content, '\\f07b')}i.icon-5{font-family:var(--icon-5-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-5-font-weight,900)}i.icon-5:before{content:var(--icon-5-content, '\\f07b')}i.icon-6{font-family:var(--icon-6-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-6-font-weight,900)}i.icon-6:before{content:var(--icon-6-content, '\\f07b')}i.icon-7{font-family:var(--icon-7-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-7-font-weight,900)}i.icon-7:before{content:var(--icon-7-content, '\\f07b')}i.icon-8{font-family:var(--icon-8-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-8-font-weight,900)}i.icon-8:before{content:var(--icon-8-content, '\\f07b')}i.icon-9{font-family:var(--icon-9-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-9-font-weight,900)}i.icon-9:before{content:var(--icon-9-content, '\\f07b')}i.icon-10{font-family:var(--icon-10-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-10-font-weight,900)}i.icon-10:before{content:var(--icon-10-content, '\\f07b')}`;class ht extends J{static get styles(){return[ut]}static get properties(){return{datas:{attribute:!1},config:{attribute:!1},onSelection:{attribute:!1}}}constructor(){super(),this._datas=[],this._initKeyboardNavigation=!1,this._activeElement=null}render(){return this._renderTree(this._datas,0,null)}willUpdate(t){super.willUpdate(t);let e=!1;t&&(e=t.has("datas")||t.has("config")),e&&(this._datas=this.datas,this._initKeyboardNavigation=!1,this._initDataList(this._datas,this.config.identifier),this._activeElement=this._datas&&this._datas.length>0?this._datas[0]:null)}updated(t){super.updated(t),this.shadowRoot.querySelectorAll('input[type="checkbox"]').forEach((t=>{const e=this._findDatasByProperty(this._datas,"idHtml",t.id.replace("-checkbox",""));e&&1===e.length&&(t.checked=e[0].selected)})),this._initKeyboardNavigation&&this.activeElement&&this.shadowRoot.querySelectorAll("li").forEach((t=>{t.id===this.activeElement.idHtml&&t.focus()}))}selectNode(t){if(t){const e=this._findDatasByProperty(this._datas,"id",t);e&&e.length>0&&!e[0].selected&&this._onClickItem(null,e[0])}}deselectAllNodes(){const t=this._findDatasByProperty(this._datas,"selected",!0);t&&t.length>0&&(this._unSelectDatas(this._datas),this.requestUpdate(),this._sendSelection())}addNode(t,e){if(t){const i=this._findDatasByProperty(this._datas,"id",t);i&&i.length>0&&i[0].areChildrenLoaded&&(this._initDataList([e],i[0].idHtml),e.parent=i[0],i[0].loadedChildren.push(e),this.requestUpdate())}else this._initDataList([e],this.config.identifier),e.parent=null,this._datas.push(e),this.requestUpdate()}deleteNode(t){if(t){const e=this._findDatasByProperty(this._datas,"id",t);if(e&&e.length>0){const t=this._findDatasByProperty(this._datas,"selected",!0);e[0].parent?e[0].parent.loadedChildren=e[0].parent.loadedChildren.filter((t=>t.id!==e[0].id)):this._datas=this._datas.filter((t=>t.id!==e[0].id)),this.requestUpdate();const i=this._findDatasByProperty(this._datas,"selected",!0);t.length!==i.length&&this._sendSelection()}}}refreshNode(t,e,i=!1){if(t){const o=this._findDatasByProperty(this._datas,"id",t);if(o&&o.length>0){const t=this._findDatasByProperty(this._datas,"selected",!0);this._refreshNodes(o[0],e,i).then((()=>{this.requestUpdate();const e=this._findDatasByProperty(this._datas,"selected",!0);t.length!==e.length&&this._sendSelection()}))}}}_renderTree(t,e,i){return j`<ul id="${this.config.identifier}" class="${0===e?"root-tree":i.ulClasses.join(" ")}" role="${0===e?this.config.isMultipleSelection?"listbox":"tree":"group"}" aria-multiselectable="${0===e&&this.config.isMultipleSelection?"true":"false"}" tabindex="${0===e?"0":"-1"}" aria-activedescendant="${0===e&&this.activeElement?this.activeElement.idHtml:""}" aria-labelledby="${i?i.idHtml+"-text":""}" @keydown="${t=>this._onKeyDown(t)}">${(t||[]).map((t=>j`<li id="${t.idHtml}" class="${t.liClasses.join(" ")}" tabindex="-1" aria-expanded="${t.expanded}" role="${this.config.showCheckbox?"option":"treeitem"}" aria-selected="${t.selected}"><div class="row" @click="${e=>this._onClickRow(e,t)}">${this._renderIconIndicator(t)}<div class="row-data d-flex align-items-center ${t.selected?"jstree-clicked":""}" @click="${e=>this._onClickItem(e,t)}">${this._renderCheckbox(t)} <i class="icon ${null!==t.iconIndex?"icon-"+t.iconIndex:""}" aria-hidden="true"></i> <span id="${t.idHtml}-text">${t.text}</span></div></div>${t.loadedChildren?this._renderTree(t.loadedChildren,e+1,t):""}</li>`))}</ul>`}_renderIconIndicator(t){return t.children&&(!t.areChildrenLoaded||t.loadedChildren&&t.loadedChildren.length>0)?j`<i class="icon icon-indicator"></i>`:j``}_renderCheckbox(t){return this.config.showCheckbox?j`<input type="checkbox" id="${t.idHtml}-checkbox" tabindex="-1" ?checked="${t.selected}" aria-checked="${t.selected}" aria-labelledby="${t.idHtml}-text" ?disabled="${!1===this.config.allowDeselection&&t.selected}">`:j``}_onClickItem(t,e){if(t&&t.stopPropagation(),this.activeElement=e,!1!==this.config.allowDeselection||!e.selected){const t=e.selected;this.config.isMultipleSelection||this._unSelectDatas(this._datas),e.selected=!t,this.requestUpdate(),this._sendSelection()}}_onClickRow(t,e){t.stopPropagation(),this.activeElement=e,e.children&&(e.expanded?(e.expanded=!1,e.ulClasses.includes("subtree-active")&&e.ulClasses.splice(e.ulClasses.indexOf("subtree-active"),1),e.liClasses.includes("item-active")&&e.liClasses.splice(e.liClasses.indexOf("item-active"),1),this.requestUpdate()):e.children&&(e.expanded=!0,e.ulClasses.push("subtree-active"),e.liClasses.push("item-active"),e.areChildrenLoaded?this.requestUpdate():this._loadDataChildren(e,(()=>this.requestUpdate()))))}_onKeyDown(t){if(13===t.keyCode||32===t.keyCode)this._onClickItem(t,this.activeElement);else if(37===t.keyCode)this.activeElement.expanded?(this.activeElement.expanded=!1,this.activeElement.ulClasses.includes("subtree-active")&&this.activeElement.ulClasses.splice(this.activeElement.ulClasses.indexOf("subtree-active"),1),this.activeElement.liClasses.includes("item-active")&&this.activeElement.liClasses.splice(this.activeElement.liClasses.indexOf("item-active"),1)):this.activeElement.parent&&this.activeElement.parent.expanded&&(this.activeElement=this.activeElement.parent),t.preventDefault(),t.stopPropagation(),this.requestUpdate();else if(38===t.keyCode){const e=this._getUpVisibleSiblingElement(this.activeElement);null!=e&&(this.activeElement=e),t.preventDefault(),t.stopPropagation(),this.requestUpdate()}else if(39===t.keyCode)this.activeElement.children?this.activeElement.expanded?(this.activeElement.loadedChildren&&this.activeElement.loadedChildren.length>0&&(this.activeElement=this.activeElement.loadedChildren[0]),t.preventDefault(),t.stopPropagation(),this.requestUpdate()):(this.activeElement.expanded=!0,this.activeElement.ulClasses.push("subtree-active"),this.activeElement.liClasses.push("item-active"),this._loadDataChildren(this.activeElement,(()=>{t.preventDefault(),t.stopPropagation(),this.requestUpdate()}))):(t.preventDefault(),t.stopPropagation());else if(40===t.keyCode){if(this._initKeyboardNavigation)if(this.activeElement.expanded&&this.activeElement.loadedChildren&&this.activeElement.loadedChildren.length>0)this.activeElement=this.activeElement.loadedChildren[0];else{const t=this._getDownVisibleSiblingElement(this.activeElement);null!=t&&(this.activeElement=t)}t.preventDefault(),t.stopPropagation(),this.requestUpdate()}this._initKeyboardNavigation=!0}_initDataList(t,e){t&&t.length>0&&t.forEach((t=>{t.ulClasses=["subtree"],t.liClasses=[],t.children&&t.liClasses.push("item-subtree"),t.expanded=!1,t.parent=null,t.idHtml=(e||"")+"-"+t.id,t.selected=!1,t.loadedChildren=null,t.areChildrenLoaded=!1}))}_unSelectDatas(t){t.forEach((t=>{t.selected=!1,t.loadedChildren&&this._unSelectDatas(t.loadedChildren)}))}_findDatasByProperty(t,e,i){let o=[];return t.forEach((t=>{t[e]===i&&o.push(t),t.children&&t.loadedChildren&&(o=o.concat(this._findDatasByProperty(t.loadedChildren,e,i)))})),o}_loadDataChildren(t,e){this._getChildren(t,(i=>{this._initDataList(i,t.idHtml),t.loadedChildren=i,t.loadedChildren.forEach((e=>e.parent=t)),t.areChildrenLoaded=!0,e&&e()}))}_getChildren(t,e){"function"==typeof t.getChildren?t.getChildren().then((t=>{e(t)})):(Array.isArray(t.getChildren)||t.getChildren instanceof Array)&&e(t.getChildren)}_getDownVisibleSiblingElement(t){if(t.parent){for(let e=0;e<t.parent.loadedChildren.length;e++)if(t.parent.loadedChildren[e].id===t.id)return e<t.parent.loadedChildren.length-1?t.parent.loadedChildren[e+1]:this._getDownVisibleSiblingElement(t.parent)}else for(let e=0;e<this._datas.length;e++)if(this._datas[e].id===t.id&&e<this._datas.length-1)return this._datas[e+1];return null}_getUpVisibleSiblingElement(t){if(t.parent){for(let e=0;e<t.parent.loadedChildren.length;e++)if(t.parent.loadedChildren[e].id===t.id)return e>0?this._getLastVisibleChild(t.parent.loadedChildren[e-1]):t.parent}else for(let e=0;e<this._datas.length;e++)if(this._datas[e].id===t.id&&e>0)return this._getLastVisibleChild(this._datas[e-1]);return null}_getLastVisibleChild(t){return t.expanded&&t.loadedChildren&&t.loadedChildren.length>0?this._getLastVisibleChild(t.loadedChildren[t.loadedChildren.length-1]):t}_sendSelection(){if(this.onSelection){const t=this._findDatasByProperty(this._datas,"selected",!0);this.onSelection(t)}}_refreshNodes(t,e,i){return new Promise((o=>{Object.assign(t,e),i&&t.children&&t.areChildrenLoaded?this._getChildren(t,(e=>{const s=e.map((t=>t.id));t.loadedChildren=t.loadedChildren.filter((t=>s.includes(t.id)));let a=0;const r=[];e.forEach((e=>{const o=t.loadedChildren.find((t=>t.id===e.id));o?r.push(this._refreshNodes(o,e,i)):(this._initDataList([e],t.idHtml),e.parent=t,t.loadedChildren.splice(a,0,e)),a++})),Promise.all(r).then((()=>o()))})):o()}))}}customElements.get("esup-js-tree")||customElements.define("esup-js-tree",ht);class pt extends J{static get styles(){return[lt,ct,at]}static get properties(){return{searchType:{attribute:!1},withExtended:{attribute:!1},searchId:{attribute:!1},multiSelection:{attribute:!1},config:{attribute:!1},onSelection:{attribute:!1}}}constructor(){super(),this._localization=new ot(dt,"fr"),this._container={subjects:[]},this._tooltips=[],this._search={queryUserTerm:"",filter:""},this._resultsArr=[],this._userResult=[],this._nbTotalItems=0,this._currentPage=1,this._numPerPage=10,this._listNumPerPage=[5,10,25,50,100]}render(){var t=j``,e=j``;return"PERSON"!==this.searchType&&(t=j`${t} <button type="button" class="btn btn-default btn-outline-dark" @click="${()=>this._showGroupListModal()}"><i class="icon icon-plus"></i><span> ${this._localization.getLabel("type.group")}</span></button>`,e=j`${e} ${this._renderGroupListModal()}`),"GROUP"!==this.searchType&&(t=j`${t} <button type="button" class="btn btn-default btn-outline-dark" @click="${()=>this._showUserListModal()}"><i class="icon icon-plus"></i><span> ${this._localization.getLabel("type.user")}</span></button> <button type="button" class="btn btn-default btn-outline-dark" @click="${()=>this._showUserFromGroupListModal()}"><i class="icon icon-plus"></i><span> ${this._localization.getLabel("type.userfromgroup")}</span></button>`,e=j`${e} ${this._renderUserListModal()} ${this._renderUserFromGroupListModal()}`),t=j`<div class="btn-group" role="group" aria-label="SearchOnUserType">${t}</div>`,this.withExtended&&(t=j`${t}<div class="btn-group" role="group" aria-label="SearchOnUserType"><button type="button" class="btn btn-default btn-outline-dark" @click="${()=>this._showUserAttributeModal()}"><i class="icon icon-plus"></i><span> ${this._localization.getLabel("type.userfromattr")}</span></button> <button type="button" class="btn btn-default btn-outline-dark" @click="${()=>this._showUserAttributeRegexModal()}"><i class="icon icon-plus"></i><span> ${this._localization.getLabel("type.userfromregexattr")}</span></button></div>`,e=j`${e} ${this._renderUserAttributeModal()} ${this._renderUserAttributeRegexModal()}`),j`<div class="subject-search-button">${t} ${e}</div>`}willUpdate(t){super.willUpdate(t);let e=!1;t&&(e=t.has("config")),e&&(this._localization.labels=dt,this._localization.lang=this.config&&this.config.lang?this.config.lang:this._localization.lang,this.config&&this.config.labels&&this._localization.mergeLabels(this.config.labels)),this._tooltips.length=0}updated(t){super.updated(t),this.shadowRoot.querySelectorAll("#userListModal"+this.searchId+' input[type="radio"]').forEach((t=>{t.checked=this._resultsArr[t.dataset.index]===this._container.subject})),this.shadowRoot.querySelectorAll("#userListModal"+this.searchId+' input[type="checkbox"]').forEach((t=>{t.checked=this._container.subjects.includes(this._resultsArr[t.dataset.index])})),this.shadowRoot.querySelectorAll("#userFromGroupListModal"+this.searchId+' input[type="radio"]').forEach((t=>{t.checked=this._resultsArr[t.dataset.index]===this._container.subject})),this.shadowRoot.querySelectorAll("#userFromGroupListModal"+this.searchId+' input[type="checkbox"]').forEach((t=>{t.checked=this._container.subjects.includes(this._resultsArr[t.dataset.index])})),this._tooltips.forEach((t=>t.updateToolTip(this.shadowRoot)))}_renderGroupListModal(){return j`<div class="modal fade" id="${"groupListModal"+this.searchId}" tabindex="-1" role="dialog" aria-labelledby="myGroupListLabel" aria-hidden="true" @click="${()=>this._hideGroupListModal()}"><div class="modal-dialog modal-lg"><div class="modal-content" @click="${t=>t.stopPropagation()}"><div class="modal-header"><h4 id="myGroupListLabel" class="modal-title">${this._localization.getLabel("search.targets.group")}</h4><button type="button" class="btn-close" @click="${()=>this._hideGroupListModal()}" aria-hidden="true"></button></div><div class="modal-body tree"></div><div class="modal-footer"><button type="button" class="btn btn-default btn-outline-dark" @click="${()=>this._hideGroupListModal()}"><span class="icon icon-cancel"></span> <span>${this._localization.getLabel("cancel")}</span></button> <button type="button" class="btn btn-primary validate" @click="${()=>this._submitGroupListModal()}" .disabled="${!this._canSubmit()}"><span class="icon icon-validate"></span> <span>${this._localization.getLabel("validate")}</span></button></div></div></div></div>`}_renderUserListModal(){return j`<div class="modal fade" id="${"userListModal"+this.searchId}" tabindex="-1" role="dialog" aria-labelledby="myUserListLabel" aria-hidden="true" @click="${()=>this._hideUserListModal()}"><div class="modal-dialog modal-lg"><div class="modal-content" @click="${t=>t.stopPropagation()}"><div class="modal-header"><h4 id="myUserListLabel" class="modal-title">${this._localization.getLabel("search.targets.user")}</h4><button type="button" class="btn-close" @click="${()=>this._hideUserListModal()}" aria-hidden="true"></button></div><div class="modal-body"><form name="searchUserForm" role="form" novalidate @keydown="${t=>{13===t.keyCode&&(t.preventDefault(),this._searchUser())}}"><div class="row g-3 align-items-center"><div class="col-auto"><label for="search" class="col-form-label fw-bold"><span>${this._localization.getLabel("user.search.label")}</span> <span class="icon icon-question" data-tooltip aria-describedby="tooltipuserListModal" @mouseenter="${()=>this._showToolTip("userListModal")}" @mouseleave="${()=>this._hideToolTip("userListModal")}">${this._renderToolTip("userListModal",this._localization.getLabel("user.search.desc"))}</span></label></div><div class="col-auto"><div class="input-group"><input class="form-control" type="text" id="search" name="search" placeholder="${this._localization.getLabel("user.search.placeholder")}" value="${this._search.queryUserTerm}" required minlength="3" @keyup="${t=>this._onInputUserTerm(t.target.value)}"> <button type="button" class="btn btn-outline-secondary search" .disabled="${this._search.queryUserTerm.length<3}" @click="${()=>this._searchUser()}"><i class="icon icon-search"></i></button></div></div></div></form>${this._userResult.length>0?j`<div class="card mt-3"><div class="card-header"><div class="row g-3 align-items-center"><div class="col-auto"><div class="row g-3 align-items-center"><div class="col-auto"><label for="filter">${this._localization.getLabel("filter.label")}</label></div><div class="col-auto"><input id="filter" type="text" @keyup="${t=>this._onInputFilter(t.target.value)}" class="form-control" placeholder="${this._localization.getLabel("filter.placeholder")}"></div></div></div><div class="col-auto"><div class="row g-3 align-items-center"><div class="col-auto"><label for="nbItems">${this._localization.getLabel("pager.nbItems")}</label></div><div class="col-auto"><select id="nbItems" class="form-select" @change="${t=>this._onChangeNumPerPage(t.target.value)}">${this._listNumPerPage.map((t=>j`<option value="${t}" ?selected="${this._numPerPage===t}">${t}</option>`))}</select></div></div></div></div></div><div class="card-body"><ul class="list-unstyled">${this._resultsArr.map(((t,e)=>j`<li><input type="${this.multiSelection?"checkbox":"radio"}" name="user" id="${"user"+e}" data-index="${e}" @click="${()=>this._onUserListSelection(t)}"> <label for="${"user"+e}" data-tooltip aria-describedby="${"tooltipuser"+e}" @mouseenter="${()=>this._showToolTip("user"+e)}" @mouseleave="${()=>this._hideToolTip("user"+e)}">${t.displayName} ${this._renderToolTip("user"+e,this._tooltipUser(t))}</label></li>`))}</ul></div><div class="card-footer"><nav><ul class="pagination" aria-label="Navigation par page"><li @click="${t=>this._goToPage(t,1)}" class="page-item ${this._currentPage<=1?"disabled":""}"><a class="page-link" href="" tabindex="${this._currentPage<=1?-1:0}" aria-disabled="${this._currentPage<=1}">&lt;&lt;</a></li><li @click="${t=>this._goToPage(t,this._currentPage-1)}" class="page-item ${this._currentPage<=1?"disabled":""}"><a class="page-link" href="" tabindex="${this._currentPage<=1?-1:0}" aria-disabled="${this._currentPage<=1}">&lt;</a></li>${this._getVisiblePages().map((t=>j`<li class="page-item ${this._currentPage===t?"active":""}" @click="${e=>this._goToPage(e,t)}"><a class="page-link" href="">${t}</a></li>`))}<li @click="${t=>this._goToPage(t,this._currentPage+1)}" class="page-item ${this._currentPage>=this._getTotalPage()?"disabled":""}"><a class="page-link" href="" tabindex="${this._currentPage>=this._getTotalPage()?-1:0}" aria-disabled="${this._currentPage>=this._getTotalPage()}">></a></li><li @click="${t=>this._goToPage(t,this._getTotalPage())}" class="page-item ${this._currentPage>=this._getTotalPage()?"disabled":""}"><a class="page-link" href="" tabindex="${this._currentPage>=this._getTotalPage()?-1:0}" aria-disabled="${this._currentPage>=this._getTotalPage()}">>></a></li></ul></nav></div></div>`:j``}</div><div class="modal-footer"><button type="button" class="btn btn-default btn-outline-dark" @click="${()=>this._hideUserListModal()}"><span class="icon icon-cancel"></span> <span>${this._localization.getLabel("cancel")}</span></button> <button type="button" class="btn btn-primary validate" @click="${()=>this._submitUserListModal()}" .disabled="${!this._canSubmit()}"><span class="icon icon-validate"></span> <span>${this._localization.getLabel("validate")}</span></button></div></div></div></div>`}_renderUserFromGroupListModal(){return j`<div class="modal fade" id="${"userFromGroupListModal"+this.searchId}" tabindex="-1" role="dialog" aria-labelledby="myUserFromGroupListLabel" aria-hidden="true" @click="${()=>this._hideUserFromGroupListModal()}"><div class="modal-dialog modal-lg"><div class="modal-content" @click="${t=>t.stopPropagation()}"><div class="modal-header"><h4 id="myUserFromGroupListLabel" class="modal-title">${this._localization.getLabel("search.targets.userFromGroup")}</h4><button type="button" class="btn-close" @click="${()=>this._hideUserFromGroupListModal()}" aria-hidden="true"></button></div><div class="modal-body"><div class="card"><div class="card-header"><span>${this._localization.getLabel("userFromGroup.label")}</span></div><div class="card-body tree"></div></div>${this._userResult.length>0?j`<div class="card mt-2"><div class="card-header"><div class="row g-3 align-items-center"><div class="col-auto"><div class="row g-3 align-items-center"><div class="col-auto"><label for="grpFilter">${this._localization.getLabel("filter.label")}</label></div><div class="col-auto"><input id="grpFilter" type="text" @keyup="${t=>this._onInputFilter(t.target.value)}" class="form-control" placeholder="${this._localization.getLabel("filter.placeholder")}"></div></div></div><div class="col-auto"><div class="row g-3 align-items-center"><div class="col-auto"><label for="grpNbItems">${this._localization.getLabel("pager.nbItems")}</label></div><div class="col-auto"><select id="grpNbItems" class="form-select" @change="${t=>this._onChangeNumPerPage(t.target.value)}">${this._listNumPerPage.map((t=>j`<option value="${t}" ?selected="${this._numPerPage===t}">${t}</option>`))}</select></div></div></div></div></div><div class="card-body"><ul class="list-unstyled">${this._resultsArr.map(((t,e)=>j`<li><input type="${this.multiSelection?"checkbox":"radio"}" name="grpUser" id="${"grpUser"+e}" data-index="${e}" @click="${()=>this._onUserFromGroupListSelection(t)}"> <label for="${"grpUser"+e}" data-tooltip aria-describedby="${"tooltipgrpUser"+e}" @mouseenter="${()=>this._showToolTip("grpUser"+e)}" @mouseleave="${()=>this._hideToolTip("grpUser"+e)}">${t.displayName} ${this._renderToolTip("grpUser"+e,this._tooltipUser(t))}</label></li>`))}</ul></div><div class="card-footer"><nav><ul class="pagination" aria-label="Navigation par page"><li @click="${t=>this._goToPage(t,1)}" class="page-item ${this._currentPage<=1?"disabled":""}"><a class="page-link" href="" tabindex="${this._currentPage<=1?-1:0}" aria-disabled="${this._currentPage<=1}">&lt;&lt;</a></li><li @click="${t=>this._goToPage(t,this._currentPage-1)}" class="page-item ${this._currentPage<=1?"disabled":""}"><a class="page-link" href="" tabindex="${this._currentPage<=1?-1:0}" aria-disabled="${this._currentPage<=1}">&lt;</a></li>${this._getVisiblePages().map((t=>j`<li class="page-item ${this._currentPage===t?"active":""}" @click="${e=>this._goToPage(e,t)}"><a class="page-link" href="">${t}</a></li>`))}<li @click="${t=>this._goToPage(t,this._currentPage+1)}" class="page-item ${this._currentPage>=this._getTotalPage()?"disabled":""}"><a class="page-link" href="" tabindex="${this._currentPage>=this._getTotalPage()?-1:0}" aria-disabled="${this._currentPage>=this._getTotalPage()}">></a></li><li @click="${t=>this._goToPage(t,this._getTotalPage())}" class="page-item ${this._currentPage>=this._getTotalPage()?"disabled":""}"><a class="page-link" href="" tabindex="${this._currentPage>=this._getTotalPage()?-1:0}" aria-disabled="${this._currentPage>=this._getTotalPage()}">>></a></li></ul></nav></div></div>`:j``}</div><div class="modal-footer"><button type="button" class="btn btn-default btn-outline-dark" @click="${()=>this._hideUserFromGroupListModal()}"><span class="icon icon-cancel"></span> <span>${this._localization.getLabel("cancel")}</span></button> <button type="button" class="btn btn-primary validate" @click="${()=>this._submitUserFromGroupListModal()}" .disabled="${!this._canSubmit()}"><span class="icon icon-validate"></span> <span>${this._localization.getLabel("validate")}</span></button></div></div></div></div>`}_renderUserAttributeModal(){return j`<div class="modal fade" id="${"userAttributeModal"+this.searchId}" tabindex="-1" role="dialog" aria-labelledby="myUserAttributeLabel" aria-hidden="true" @click="${()=>this._hideUserAttributeModal()}"><div class="modal-dialog modal-lg"><div class="modal-content" @click="${t=>t.stopPropagation()}"><div class="modal-header"><h4 class="modal-title" id="myUserAttributeLabel">${this._localization.getLabel("search.targets.userAttrs")}</h4><button type="button" class="btn-close" @click="${()=>this._hideUserAttributeModal()}" aria-hidden="true"></button></div><div class="modal-body"><label class="form-label fw-bold" for="userAttribute">${this._localization.getLabel("userAttr.attribute.label")}</label> <select id="userAttribute" name="userAttribute" class="form-select" @change="${t=>this._onChangeUserAttribute(t.target.value)}" required><option value="" selected="selected"></option>${(this.config.extendedAttrs||[]).sort(((t,e)=>t.localeCompare(e))).map((t=>j`<option value="${t}">${t}</option>`))}</select> <label class="form-label fw-bold mt-3" for="userValue">${this._localization.getLabel("userAttr.value.label")}</label> <input type="text" class="form-control" id="userValue" name="userValue" required minlength="3" maxlength="512" @keyup="${t=>this._onInputUserAttrValue(t.target.value)}"></div><div class="modal-footer"><button type="button" class="btn btn-default btn-outline-dark" @click="${()=>this._hideUserAttributeModal()}"><span class="icon icon-cancel"></span> <span>${this._localization.getLabel("cancel")}</span></button> <button type="button" class="btn btn-primary validate" @click="${()=>this._submitUserAttributeModal()}" .disabled="${!this._canSubmit()}"><span class="icon icon-validate"></span> <span>${this._localization.getLabel("validate")}</span></button></div></div></div></div>`}_renderUserAttributeRegexModal(){return j`<div class="modal fade" id="${"userAttributeRegexModal"+this.searchId}" tabindex="-1" role="dialog" aria-labelledby="myUserAttributeRegexLabel" aria-hidden="true" @click="${()=>this._hideUserAttributeRegexModal()}"><div class="modal-dialog modal-lg"><div class="modal-content" @click="${t=>t.stopPropagation()}"><div class="modal-header"><h4 id="myUserAttributeRegexLabel" class="modal-title">${this._localization.getLabel("search.targets.userRegexAttr")}</h4><button type="button" class="btn-close" @click="${()=>this._hideUserAttributeRegexModal()}" aria-hidden="true"></button></div><div class="modal-body"><label class="form-label fw-bold" for="userRegexAttribute">${this._localization.getLabel("userRegexAttr.attribute.label")}</label> <select id="userRegexAttribute" name="userRegexAttribute" class="form-select" @change="${t=>this._onChangeUserRegexAttribute(t.target.value)}" required><option value="" selected="selected"></option>${(this.config.extendedAttrs||[]).sort(((t,e)=>t.localeCompare(e))).map((t=>j`<option value="${t}">${t}</option>`))}</select> <label class="form-label fw-bold mt-3" for="userRegexValue">${this._localization.getLabel("userRegexAttr.value.label")}</label> <input type="text" class="form-control" id="userRegexValue" name="userRegexValue" required minlength="3" maxlength="512" @keyup="${t=>this._onInputUserRegexAttrValue(t.target.value)}"></div><div class="modal-footer"><button type="button" class="btn btn-default btn-outline-dark" @click="${()=>this._hideUserAttributeRegexModal()}"><span class="icon icon-cancel"></span> <span>${this._localization.getLabel("cancel")}</span></button> <button type="button" class="btn btn-primary validate" @click="${()=>this._submitUserAttributeRegexModal()}" .disabled="${!this._canSubmit()}"><span class="icon icon-validate"></span> <span>${this._localization.getLabel("validate")}</span></button></div></div></div></div>`}_renderToolTip(t,e){const i=new st("tooltip"+t);return this._tooltips.push(i),i.renderToolTip(e)}_showToolTip(t){const e=this._tooltips.find((e=>e.id==="tooltip"+t));e&&e.showToolTip()}_hideToolTip(t){const e=this._tooltips.find((e=>e.id==="tooltip"+t));e&&e.hideToolTip()}_showGroupListModal(){this._clearSubject();var t=this.shadowRoot.querySelector("#jsTreeGroup"+this.searchId);t||((t=document.createElement("esup-js-tree")).setAttribute("id","jsTreeGroup"+this.searchId),t.datas=this.config.treeGroupDatas,t.config=Object.assign({showCheckbox:!0,isMultipleSelection:this.multiSelection},this.config),t.onSelection=t=>this._onTreeGroupSelection(t),this.shadowRoot.querySelector("#groupListModal"+this.searchId+" .tree").appendChild(t)),this.shadowRoot.querySelector("#groupListModal"+this.searchId+" button.validate").disabled=!this._canSubmit(),this._showModal("groupListModal"+this.searchId)}_hideGroupListModal(){this._clearSubject();const t=this.shadowRoot.querySelector("#jsTreeGroup"+this.searchId);t&&t.remove(),this._hideModal("groupListModal"+this.searchId)}_submitGroupListModal(){this._submitSubject(),this._hideGroupListModal()}_showUserListModal(){this._clearSubject(),this.shadowRoot.querySelector("#userListModal"+this.searchId+" #search").value=this._search.queryUserTerm,this.shadowRoot.querySelector("#userListModal"+this.searchId+" button.search").disabled=this._search.queryUserTerm.length<3,this.shadowRoot.querySelector("#userListModal"+this.searchId+" button.validate").disabled=!this._canSubmit(),this._showModal("userListModal"+this.searchId)}_hideUserListModal(){this._clearSubject(),this._hideModal("userListModal"+this.searchId)}_submitUserListModal(){this._submitSubject(),this._hideUserListModal()}_showUserFromGroupListModal(){this._clearSubject();var t=this.shadowRoot.querySelector("#jsTreeUserFromGroup"+this.searchId);t||((t=document.createElement("esup-js-tree")).setAttribute("id","jsTreeUserFromGroup"+this.searchId),t.datas=this.config.treeGroupDatas,t.config=Object.assign({showCheckbox:!1,isMultipleSelection:!1,allowDeselection:!1},this.config),t.onSelection=t=>this._onTreeUserFromGroupSelection(t),this.shadowRoot.querySelector("#userFromGroupListModal"+this.searchId+" .tree").appendChild(t)),this.shadowRoot.querySelector("#userFromGroupListModal"+this.searchId+" button.validate").disabled=!this._canSubmit(),this._showModal("userFromGroupListModal"+this.searchId)}_hideUserFromGroupListModal(){this._clearSubject();const t=this.shadowRoot.querySelector("#jsTreeUserFromGroup"+this.searchId);t&&t.remove(),this._hideModal("userFromGroupListModal"+this.searchId)}_submitUserFromGroupListModal(){this._submitSubject(),this._hideUserFromGroupListModal()}_showUserAttributeModal(){this._clearSubject(),this._container.extendedSubject={keyAttribute:null,keyValue:null,keyType:"PERSON_ATTR"},this.shadowRoot.querySelector("#userAttributeModal"+this.searchId+' option[value=""]').selected=!0,this.shadowRoot.querySelector("#userAttributeModal"+this.searchId+" #userValue").value="",this.shadowRoot.querySelector("#userAttributeModal"+this.searchId+" button.validate").disabled=!this._canSubmit(),this._showModal("userAttributeModal"+this.searchId)}_hideUserAttributeModal(){this._clearSubject(),this._hideModal("userAttributeModal"+this.searchId)}_submitUserAttributeModal(){this._submitSubject(),this._hideUserAttributeModal()}_showUserAttributeRegexModal(){this._clearSubject(),this._container.extendedSubject={keyAttribute:null,keyValue:null,keyType:"PERSON_ATTR_REGEX"},this.shadowRoot.querySelector("#userAttributeRegexModal"+this.searchId+' option[value=""]').selected=!0,this.shadowRoot.querySelector("#userAttributeRegexModal"+this.searchId+" #userRegexValue").value="",this.shadowRoot.querySelector("#userAttributeRegexModal"+this.searchId+" button.validate").disabled=!this._canSubmit(),this._showModal("userAttributeRegexModal"+this.searchId)}_hideUserAttributeRegexModal(){this._clearSubject(),this._hideModal("userAttributeRegexModal"+this.searchId)}_submitUserAttributeRegexModal(){this._submitSubject(),this._hideUserAttributeRegexModal()}_canSubmit(){return rt.isDefined(this._container.subject)&&rt.isDefined(this._container.subject.modelId)&&this._container.subject.modelId!=={}||rt.isDefined(this._container.extendedSubject)&&this._container.extendedSubject!=={}&&null!==this._container.extendedSubject.keyAttribute&&""!==this._container.extendedSubject.keyAttribute&&null!==this._container.extendedSubject.keyValue&&this._container.extendedSubject.keyValue.length>=3&&this._container.extendedSubject.keyValue.length<=512||rt.isDefined(this._container.subjects)&&this._container.subjects.length>0&&rt.isDefined(this._container.subjects[this._container.subjects.length-1].modelId)&&this._container.subjects[this._container.subjects.length-1].modelId!=={}}_submitSubject(){let t=[];this._container.subjects&&rt.isArray(this._container.subjects)&&this._container.subjects.length>0?this.multiSelection?t=this._container.subjects:t.push(this._container.subjects[this._container.subjects.length-1]):rt.isDefined(this._container.subject)&&rt.isDefined(this._container.subject.modelId)&&this._container.subject.modelId!=={}?t.push(this._container.subject):rt.isDefined(this._container.extendedSubject)&&this._container.extendedSubject!=={}&&t.push(this._container.extendedSubject),this.onSelection&&this.onSelection(t)}_showModal(t){let e=this.shadowRoot.querySelector("#"+t);if(e){if(!this.shadowRoot.querySelector(".modal-backdrop")){const t=document.createElement("div");t.className="modal-backdrop fade",this.shadowRoot.append(t),t.classList.add("show")}e.style.display="block",e.removeAttribute("aria-hidden"),e.setAttribute("aria-modal",!0),e.setAttribute("role","dialog"),e.scrollTop=0,e.querySelector(".modal-body").scrollTop=0,e.classList.add("show"),e.focus()}}_hideModal(t){let e=this.shadowRoot.querySelector("#"+t);e&&(e.classList.remove("show"),e.setAttribute("aria-hidden",!0),e.removeAttribute("aria-modal"),e.removeAttribute("role"),setTimeout((()=>{e.style.display="none";const t=this.shadowRoot.querySelector(".modal-backdrop");t.classList.remove("show"),setTimeout((()=>{t.remove()}),200)}),200))}_tooltipUser(t){const e=this.config.userDisplayedAttrs||[];if(rt.isDefined(e)&&rt.isDefined(t)&&rt.isDefined(t.attributes)){var i,o=t.attributes,s="";for(i=0;i<e.length;++i){var a;if(i>0&&rt.isDefined(o[e[i]])&&(s+=" - "),rt.isDefined(o[e[i]])&&rt.isArray(o[e[i]]))for(a=0;a<o[e[i]].length;++a)a>0&&(s+=", "),s+=o[e[i]][a];else rt.isDefined(o[e[i]])&&(s+=o[e[i]])}return s}}_onTreeGroupSelection(t){this._container.subjects=t.map((t=>t.a_attr.model)),this.shadowRoot.querySelector("#groupListModal"+this.searchId+" button.validate").disabled=!this._canSubmit()}_onTreeUserFromGroupSelection(t){this._resultsArr=[],this._userResult=[],this._search.filter="",this._currentPage=1,this._nbTotalItems=0,this.config.getGroupMembers&&t.length>0&&this.config.getGroupMembers(t[0].a_attr.model.modelId.keyId).then((t=>{t.length>0&&(this._userResult=t,this._userResult.sort(((t,e)=>t.displayName.localeCompare(e.displayName))),this._nbTotalItems=this._userResult.length,this._resultsArr=this._userResult.slice(0,this._numPerPage),this.requestUpdate())})),this._container.subject=void 0,this._container.subjects=[],this.shadowRoot.querySelector("#userFromGroupListModal"+this.searchId+" button.validate").disabled=!this._canSubmit()}_onUserFromGroupListSelection(t){if(this.multiSelection)if(rt.isDefined(this._container.subjects)&&this._container.subjects.length>0){let e=-1;for(let i=0;i<this._container.subjects.length;i++)if(this._container.subjects[i]===t){e=i;break}e>-1?this._container.subjects.splice(e,1):this._container.subjects.push(t)}else this._container.subjects=[t];else this._container.subject=t;this.shadowRoot.querySelector("#userFromGroupListModal"+this.searchId+" button.validate").disabled=!this._canSubmit()}_onInputUserTerm(t){this._search.queryUserTerm=t,this.shadowRoot.querySelector("#userListModal"+this.searchId+" button.search").disabled=this._search.queryUserTerm.length<3}_onInputFilter(t){if(this._search.filter!==t){this._search.filter=t,this._currentPage=1;var e=this._filterOnDisplayName(this._userResult,t);this._resultsArr=e.slice(0,this._numPerPage),this._nbTotalItems=e.length,this.requestUpdate()}}_onChangeNumPerPage(t){const e=Number(t);this._numPerPage!==e&&(this._numPerPage=e,this._currentPage=1,this._resultsArr=this._filterOnDisplayName(this._userResult,this._search.filter).slice(0,this._numPerPage),this.requestUpdate())}_getTotalPage(){return Math.max(1,Math.ceil(this._nbTotalItems/this._numPerPage))}_goToPage(t,e){t.preventDefault(),t.stopPropagation(),e>0&&e<=this._getTotalPage()&&e!==this._currentPage&&(this._currentPage=e,this._resultsArr=this._filterOnDisplayName(this._userResult,this._search.filter).slice(this._numPerPage*(this._currentPage-1),this._numPerPage*(this._currentPage-1)+this._numPerPage),this.requestUpdate())}_getVisiblePages(){const t=Math.max(1,this._currentPage-2),e=Math.min(this._getTotalPage(),this._currentPage+2),i=[];for(let o=t;o<=e;o++)i.push(o);if(i.length<this._getTotalPage())for(;i.length<Math.min(this._getTotalPage(),5);)i[0]>1&&i.splice(0,0,i[0]-1),i[i.length-1]<this._getTotalPage()&&i.splice(i.length,0,i[i.length-1]+1);return i}_onUserListSelection(t){if(this.multiSelection)if(rt.isDefined(this._container.subjects)&&this._container.subjects.length>0){let e=-1;for(let i=0;i<this._container.subjects.length;i++)if(this._container.subjects[i]===t){e=i;break}e>-1?this._container.subjects.splice(e,1):this._container.subjects.push(t)}else this._container.subjects=[t];else this._container.subject=t;this.shadowRoot.querySelector("#userListModal"+this.searchId+" button.validate").disabled=!this._canSubmit()}_filterOnDisplayName(t,e){if(!rt.isDefined(e)||""===e)return t;var i=[];return t.forEach((t=>{-1!==t.displayName.toLowerCase().indexOf(e.toLowerCase())&&i.push(t)})),i}_searchUser(){this._search.queryUserTerm&&this._search.queryUserTerm.length>=3&&(this._resultsArr=[],this._userResult=[],this._search.filter="",this._currentPage=1,this._nbTotalItems=0,this.config.searchUsers&&this.config.searchUsers(this._search.queryUserTerm).then((t=>{t.length>0&&(this._userResult=t,this._userResult.sort(((t,e)=>t.displayName.localeCompare(e.displayName))),this._nbTotalItems=this._userResult.length,this._resultsArr=this._userResult.slice(0,this._numPerPage),this.requestUpdate())})),this._container.subject=void 0,this._container.subjects=[],this.shadowRoot.querySelector("#userListModal"+this.searchId+" button.validate").disabled=!this._canSubmit())}_onChangeUserAttribute(t){this._container.extendedSubject.keyAttribute=t,this.shadowRoot.querySelector("#userAttributeModal"+this.searchId+" button.validate").disabled=!this._canSubmit()}_onInputUserAttrValue(t){this._container.extendedSubject.keyValue=t,this.shadowRoot.querySelector("#userAttributeModal"+this.searchId+" button.validate").disabled=!this._canSubmit()}_onChangeUserRegexAttribute(t){this._container.extendedSubject.keyAttribute=t,this.shadowRoot.querySelector("#userAttributeRegexModal"+this.searchId+" button.validate").disabled=!this._canSubmit()}_onInputUserRegexAttrValue(t){this._container.extendedSubject.keyValue=t,this.shadowRoot.querySelector("#userAttributeRegexModal"+this.searchId+" button.validate").disabled=!this._canSubmit()}_clearSubject(){this._container.subject=void 0,this._container.extendedSubject=void 0,this._container.subjects=[],this._search={queryUserTerm:"",filter:""},this._resultsArr=[],this._userResult=[],this._currentPage=1,this._numPerPage=10,this.requestUpdate()}}customElements.get("esup-subject-search-button")||customElements.define("esup-subject-search-button",pt);const bt=a`.evaluator{list-style:none}`,gt={fr:{forAdvancedOnly:"Vous devez être en mode avancé pour voir ces informations !","authenticatedUsers.text":"Tous les utilisateurs authentifiés","userAttribute.subjetIs":"Utilisateur ","userAttribute.attribute":"Utilisateurs avec l'attribut '{attribute}'","userAttribute.mode":" est '{mode}'","userAttribute.value":" la valeur '{value}'","userGroup.memberOf":"Membres du groupe "},en:{forAdvancedOnly:"Only Administrators can access to this information !","authenticatedUsers.text":"All authenticated users","userAttribute.subjetIs":"User is ","userAttribute.attribute":"Users with attribute {attribute}","userAttribute.mode":" is {mode}","userAttribute.value":" to value '{value}'","userGroup.memberOf":"Members of the group "}};class mt extends J{static get styles(){return[bt,a`:host>ul{padding:0;margin:0}`]}static get properties(){return{evaluator:{attribute:!1},simple:{attribute:!1},isChild:{attribute:!1},config:{attribute:!1}}}constructor(){super(),this._localization=new ot(gt,"fr")}render(){var t=j``;if(this.evaluator&&this.evaluator.class)switch(this.evaluator.class){case"OPERATOR":this.simple?(t=j`<esup-simple-evaluators .collection="${this.evaluator.evaluators}" .config="${this.config}"></esup-simple-evaluators>`,(this.isChild||"OR"!==this.evaluator.type)&&(t=j`<span>${this._localization.getLabel("forAdvancedOnly")}</span>`)):t=j`<span>${this.evaluator.type}</span><esup-evaluators .collection="${this.evaluator.evaluators}" .config="${this.config}"></esup-evaluators>`,this.isChild||this.simple||(t=j`<ul class="evaluator"><li>${t}</li></ul>`);break;case"AUTHENTICATED":t=this.simple?j`<span>${this._localization.getLabel("forAdvancedOnly")}</span>`:j`<span>${this._localization.getLabel("authenticatedUsers.text")}</span>`;break;case"USERATTRIBUTES":case"USERMULTIVALUEDATTRIBUTES":if("uid"===this.evaluator.attribute&&"EQUALS"===this.evaluator.mode){const e={keyType:"PERSON",keyId:this.evaluator.value};t=this.simple?j`<esup-subject-infos .subject="${e}" .config="${this.config}"></esup-subject-infos>`:j`<esup-subject-infos .subject="${e}" .config="${this.config}"><span>${this._localization.getLabel("userAttribute.subjetIs")}</span></esup-subject-infos>`}else t=this.simple?j`<span>${this._localization.getLabel("forAdvancedOnly")}</span>`:j`<span>${this._localization.getLabel("userAttribute.attribute",{attribute:this.evaluator.attribute})}</span> <span>${this._localization.getLabel("userAttribute.mode",{mode:this.evaluator.mode})}</span> <span>${this._localization.getLabel("userAttribute.value",{value:this.evaluator.value})}</span>`;break;case"USERGROUP":{const e={keyType:"GROUP",keyId:this.evaluator.group};t=this.simple?j`<esup-subject-infos .subject="${e}" .config="${this.config}"></esup-subject-infos>`:j`<esup-subject-infos .subject="${e}" .config="${this.config}"><span>${this._localization.getLabel("userGroup.memberOf")}</span></esup-subject-infos>`;break}}return t}willUpdate(t){super.willUpdate(t);let e=!1;t&&(e=t.has("config")),e&&(this._localization.labels=gt,this._localization.lang=this.config&&this.config.lang?this.config.lang:this._localization.lang,this.config&&this.config.labels&&this._localization.mergeLabels(this.config.labels))}}customElements.get("esup-evaluator")||customElements.define("esup-evaluator",mt);class ft extends J{static get styles(){return[bt]}static get properties(){return{collection:{attribute:!1},config:{attribute:!1}}}render(){return j`<ul class="evaluator">${(this.collection||[]).map((t=>j`<li><esup-evaluator .evaluator="${t}" .config="${this.config}" .isChild="${!0}" .simple="${!1}"></esup-evaluator></li>`))}</ul>`}}customElements.get("esup-evaluators")||customElements.define("esup-evaluators",ft);class vt extends J{static get styles(){return[bt,a`:host>ul{padding:0;margin:0}`]}static get properties(){return{collection:{attribute:!1},config:{attribute:!1}}}render(){return j`<ul class="evaluator">${(this.collection||[]).map((t=>j`<li><esup-evaluator .evaluator="${t}" .config="${this.config}" .isChild="${!0}" .simple="${!0}"></esup-evaluator></li>`))}</ul>`}}customElements.get("esup-simple-evaluators")||customElements.define("esup-simple-evaluators",vt);const _t=a`.evaluator{list-style:none}[data-tooltip]{position:relative}.icon{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:inline-block;font-style:normal;font-variant:normal;text-rendering:auto;line-height:1;margin:0 2px}.icon-remove{font-family:var(--icon-remove-font-family, 'Font Awesome 5 Free');font-weight:var(--icon-remove-font-weight,900)}.icon-remove:before{content:var(--icon-remove-content, '\\f057')}`,yt={fr:{"add.button":"Ajouter","add.operator":"Opérateur Logique","add.user":"Personne","add.group":"Groupe","add.userAttribute":"Évaluation attribut utilisateur","add.authenticatedUsers":"Personnes authentifiées","operator.removeChilds":"Supprimer les enfants ","delete.button":"Supprimer cet élément","authenticatedUsers.text":"Tous les utilisateurs authentifiés","userAttribute.subjetIs":"Utilisateur ","unknown.text":"Évaluateur inconnu","userGroup.memberOf":"Membres du groupe "},en:{"add.button":"Add","add.operator":"Logical Operator","add.user":"User","add.group":"Group","add.userAttribute":"User's attribute","add.authenticatedUsers":"Authenticated Users","operator.removeChilds":"Remove children ","delete.button":"Remove this Evaluator","authenticatedUsers.text":"All authenticated users","userAttribute.subjetIs":"User is ","unknown.text":"Unknown Evaluator","userGroup.memberOf":"Members of the group "}},wt=a`@charset "UTF-8";/*!
    * Bootstrap v5.1.3 (https://getbootstrap.com/)
    * Copyright 2011-2021 The Bootstrap Authors
    * Copyright 2011-2021 Twitter, Inc.
    * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
    */*,::after,::before{box-sizing:border-box}.text-danger{--bs-text-opacity:1;color:rgba(220,53,69,var(--bs-text-opacity))!important}ul{padding-left:2rem;margin-top:0;margin-bottom:1rem}ul ul{margin-bottom:0}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[type=button],button{-webkit-appearance:button}[type=button]:not(:disabled),button:not(:disabled){cursor:pointer}[hidden]{display:none!important}.row{--bs-gutter-x:1.5rem;--bs-gutter-y:0;display:flex;flex-wrap:wrap;margin-top:calc(-1 * var(--bs-gutter-y));margin-right:calc(-.5 * var(--bs-gutter-x));margin-left:calc(-.5 * var(--bs-gutter-x))}.row>*{flex-shrink:0;width:100%;max-width:100%;padding-right:calc(var(--bs-gutter-x) * .5);padding-left:calc(var(--bs-gutter-x) * .5);margin-top:var(--bs-gutter-y)}.col-auto{flex:0 0 auto;width:auto}.g-0{--bs-gutter-x:0;--bs-gutter-y:0}.g-1{--bs-gutter-x:0.25rem;--bs-gutter-y:0.25rem}.form-control{display:block;width:100%;padding:.375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;background-clip:padding-box;border:1px solid #ced4da;-webkit-appearance:none;-moz-appearance:none;appearance:none;border-radius:.25rem;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media (prefers-reduced-motion:reduce){.form-control{transition:none}}.form-control:focus{color:#212529;background-color:#fff;border-color:#86b7fe;outline:0;box-shadow:0 0 0 .25rem rgba(13,110,253,.25)}.form-control::-moz-placeholder{color:#6c757d;opacity:1}.form-control::placeholder{color:#6c757d;opacity:1}.form-control:disabled,.form-control[readonly]{background-color:#e9ecef;opacity:1}.form-select{display:block;width:100%;padding:.375rem 2.25rem .375rem .75rem;-moz-padding-start:calc(.75rem - 3px);font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");background-repeat:no-repeat;background-position:right .75rem center;background-size:16px 12px;border:1px solid #ced4da;border-radius:.25rem;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out;-webkit-appearance:none;-moz-appearance:none;appearance:none}@media (prefers-reduced-motion:reduce){.form-select{transition:none}}.form-select:focus{border-color:#86b7fe;outline:0;box-shadow:0 0 0 .25rem rgba(13,110,253,.25)}.form-select[multiple],.form-select[size]:not([size='1']){padding-right:.75rem;background-image:none}.form-select:disabled{background-color:#e9ecef}.form-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #212529}.input-group{position:relative;display:flex;flex-wrap:wrap;align-items:stretch;width:100%}.input-group:not(.has-validation)>.dropdown-toggle:nth-last-child(n+3),.input-group:not(.has-validation)>:not(:last-child):not(.dropdown-toggle):not(.dropdown-menu){border-top-right-radius:0;border-bottom-right-radius:0}.input-group.has-validation>.dropdown-toggle:nth-last-child(n + 4),.input-group.has-validation>:nth-last-child(n+3):not(.dropdown-toggle):not(.dropdown-menu){border-top-right-radius:0;border-bottom-right-radius:0}.input-group>:not(:first-child):not(.dropdown-menu):not(.valid-tooltip):not(.valid-feedback):not(.invalid-tooltip):not(.invalid-feedback){margin-left:-1px;border-top-left-radius:0;border-bottom-left-radius:0}.btn{display:inline-block;font-weight:400;line-height:1.5;color:#212529;text-align:center;text-decoration:none;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;border-radius:.25rem;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media (prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529}.btn:focus{outline:0;box-shadow:0 0 0 .25rem rgba(13,110,253,.25)}.btn.disabled,.btn:disabled{pointer-events:none;opacity:.65}.btn-outline-dark{color:#212529;border-color:#212529}.btn-outline-dark:hover{color:#fff;background-color:#212529;border-color:#212529}.btn-check:focus+.btn-outline-dark,.btn-outline-dark:focus{box-shadow:0 0 0 .25rem rgba(33,37,41,.5)}.btn-check:active+.btn-outline-dark,.btn-check:checked+.btn-outline-dark,.btn-outline-dark.active,.btn-outline-dark.dropdown-toggle.show,.btn-outline-dark:active{color:#fff;background-color:#212529;border-color:#212529}.btn-check:active+.btn-outline-dark:focus,.btn-check:checked+.btn-outline-dark:focus,.btn-outline-dark.active:focus,.btn-outline-dark.dropdown-toggle.show:focus,.btn-outline-dark:active:focus{box-shadow:0 0 0 .25rem rgba(33,37,41,.5)}.btn-outline-dark.disabled,.btn-outline-dark:disabled{color:#212529;background-color:transparent}.collapse:not(.show){display:none}.collapsing{height:0;overflow:hidden;transition:height .35s ease}@media (prefers-reduced-motion:reduce){.collapsing{transition:none}}.collapsing.collapse-horizontal{width:0;height:auto;transition:width .35s ease}@media (prefers-reduced-motion:reduce){.collapsing.collapse-horizontal{transition:none}}.dropdown-toggle{white-space:nowrap}.dropdown-toggle::after{display:inline-block;margin-left:.255em;vertical-align:.255em;content:'';border-top:.3em solid;border-right:.3em solid transparent;border-bottom:0;border-left:.3em solid transparent}.dropdown-toggle:empty::after{margin-left:0}.dropdown-menu{position:absolute;z-index:1000;display:none;min-width:10rem;padding:.5rem 0;margin:0;font-size:1rem;color:#212529;text-align:left;list-style:none;background-color:#fff;background-clip:padding-box;border:1px solid rgba(0,0,0,.15);border-radius:.25rem}.dropdown-menu[data-bs-popper]{top:100%;left:0;margin-top:.125rem}.dropdown-item{display:block;width:100%;padding:.25rem 1rem;clear:both;font-weight:400;color:#212529;text-align:inherit;text-decoration:none;white-space:nowrap;background-color:transparent;border:0}.dropdown-item:focus,.dropdown-item:hover{color:#1e2125;background-color:#e9ecef}.dropdown-item.active,.dropdown-item:active{color:#fff;text-decoration:none;background-color:#0d6efd}.dropdown-item.disabled,.dropdown-item:disabled{color:#adb5bd;pointer-events:none;background-color:transparent}.dropdown-menu.show{display:block}.btn-group{position:relative;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;flex:1 1 auto}.btn-group>.btn-check:checked+.btn,.btn-group>.btn-check:focus+.btn,.btn-group>.btn.active,.btn-group>.btn:active,.btn-group>.btn:focus,.btn-group>.btn:hover{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn,.btn-group>.btn:not(:last-child):not(.dropdown-toggle){border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:nth-child(n+3),.btn-group>:not(.btn-check)+.btn{border-top-left-radius:0;border-bottom-left-radius:0}.btn-close{box-sizing:content-box;width:1em;height:1em;padding:.25em .25em;color:#000;background:transparent url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23000'%3e%3cpath d='M.293.293a1 1 0 011.414 0L8 6.586 14.293.293a1 1 0 111.414 1.414L9.414 8l6.293 6.293a1 1 0 01-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 01-1.414-1.414L6.586 8 .293 1.707a1 1 0 010-1.414z'/%3e%3c/svg%3e") center/1em auto no-repeat;border:0;border-radius:.25rem;opacity:.5}.btn-close:hover{color:#000;text-decoration:none;opacity:.75}.btn-close:focus{outline:0;box-shadow:0 0 0 .25rem rgba(13,110,253,.25);opacity:1}.btn-close.disabled,.btn-close:disabled{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;opacity:.25}.align-items-center{align-items:center!important}.fw-bold{font-weight:700!important}`;class $t extends J{static get styles(){return[_t,wt,at,a`:host>ul{padding:0}`]}static get properties(){return{evaluator:{attribute:!1},isChild:{attribute:!1},config:{attribute:!1},onModification:{attribute:!1}}}constructor(){super(),this._evaluator=void 0,this._localization=new ot(yt,"fr"),this._tooltip=new st,this._dropdown=null,this._userAttributes=[]}render(){var t=j``;if(rt.isDefined(this.config.operators)&&rt.isDefined(this.config.stringEvaluators)&&rt.isDefined(this._userAttributes)&&rt.isDefined(this._evaluator)&&rt.isDefined(this._evaluator.class))switch(this._evaluator.class){case"OPERATOR":t=this.isChild?j`<div class="row g-1 align-items-center"><div class="col-auto"><div class="row g-0 align-items-center"><div class="col-auto"><select class="form-select" @change="${t=>this._onChangeType(t.target.value)}">${this.config.operators.map((t=>j`<option value="${t}" ?selected="${this._evaluator.type===t}">${t}</option>`))}</select></div><div class="col-auto">${this._renderButtons()}</div></div></div><div class="col-auto">${this._renderDeleteEvaluator()}</div></div><esup-edit-evaluators .collection="${this._evaluator.evaluators}" .config="${this.config}" @childDeletion="${t=>this._onChildDeletionEvent(t)}" @childUpdate="${t=>this._onChildUpdateEvent(t)}"></esup-edit-evaluators>`:j`<ul class="evaluator"><li><div class="row g-0 align-items-center"><div class="col-auto"><select class="form-select" @change="${t=>this._onChangeType(t.target.value)}">${this.config.operators.map((t=>j`<option value="${t}" ?selected="${this._evaluator.type===t}">${t}</option>`))}</select></div><div class="col-auto">${this._renderButtons()}</div></div><esup-edit-evaluators .collection="${this._evaluator.evaluators}" .config="${this.config}" @childDeletion="${t=>this._onChildDeletionEvent(t)}" @childUpdate="${t=>this._onChildUpdateEvent(t)}"></esup-edit-evaluators></li></ul>`;break;case"AUTHENTICATED":t=j`<div class="row g-1 align-items-center"><div class="col-auto"><span>${this._localization.getLabel("authenticatedUsers.text")}</span></div><div class="col-auto">${this._renderDeleteEvaluator()}</div></div>`;break;case"USERATTRIBUTES":case"USERMULTIVALUEDATTRIBUTES":var e=null;if(this._evaluator.value&&"uid"===this._evaluator.attribute&&"EQUALS"===this._evaluator.mode){const t={keyType:"PERSON",keyId:this._evaluator.value};e=j`<esup-subject-infos .subject="${t}" .config="${this.config}"><span>${this._localization.getLabel("userAttribute.subjetIs")}</span></esup-subject-infos>`}else e="uid"===this._evaluator.attribute&&"EQUALS"===this._evaluator.mode?j`<esup-subject-search-button .multiSelection="${!1}" .searchType="${"PERSON"}" .searchId="${this._generateId()}" .config="${this.config}" .onSelection="${t=>this._onPersonSelection(t)}" class="input-group"></esup-subject-search-button>`:j`<div class="row g-0 align-items-center"><div class="col-auto"><select class="form-select" @change="${t=>this._onChangeAttribute(t.target.value)}">${this._userAttributes.map((t=>j`<option value="${t}" ?selected="${this._evaluator.attribute===t}">${t}</option>`))}</select></div><div class="col-auto"><select class="form-select" @change="${t=>this._onChangeMode(t.target.value)}">${this.config.stringEvaluators.map((t=>j`<option value="${t}" ?selected="${this._evaluator.mode===t}">${t}</option>`))}</select></div><div class="col-auto"><input type="text" class="form-control" value="${this._evaluator.value||""}" required @keyup="${t=>this._onChangeValue(t.target.value)}"></div></div>`;t=j`<div class="row g-1 align-items-center"><div class="col-auto">${e}</div><div class="col-auto">${this._renderDeleteEvaluator()}</div></div>`;break;case"USERGROUP":var i=null;if(this._evaluator.group&&""!==this._evaluator.group){const t={keyType:"GROUP",keyId:this._evaluator.group};i=j`<esup-subject-infos .subject="${t}" .config="${this.config}"><span>${this._localization.getLabel("userGroup.memberOf")}</span></esup-subject-infos>`}else i=j`<esup-subject-search-button .multiSelection="${!1}" .searchType="${"GROUP"}" .searchId="${this._generateId()}" .config="${this.config}" .onSelection="${t=>this._onGroupSelection(t)}" class="input-group"></esup-subject-search-button>`;t=j`<div class="row g-1 align-items-center"><div class="col-auto">${i}</div><div class="col-auto">${this._renderDeleteEvaluator()}</div></div>`;break;default:t=j`<div class="row g-1 align-items-center"><div class="col-auto"><span>${this._localization.getLabel("unknown.text")}</span></div><div class="col-auto">${this._renderDeleteEvaluator()}</div></div>`}return t}willUpdate(t){super.willUpdate(t);let e=!1;t&&(e=t.has("evaluator")||t.has("config")),e&&(this._evaluator=this.evaluator,this._userAttributes=this.config.userAttributes.filter((t=>"uid"!==t)),this._localization.labels=yt,this._localization.lang=this.config&&this.config.lang?this.config.lang:this._localization.lang,this.config&&this.config.labels&&this._localization.mergeLabels(this.config.labels))}updated(t){super.updated(t),this._tooltip.updateToolTip(this.shadowRoot),this._dropdown=this.shadowRoot.querySelector("#dropdown")}isValid(){return this._isValidEvaluator(this._evaluator)}_renderButtons(){return j`<div class="btn-group" role="group"><div class="btn-group" role="group" id="dropdown" @focusout="${t=>this._onDropDownFocusOut(t)}" @keydown="${t=>this._onDropDownKeyDown(t)}"><button type="button" id="dropdown-btn" class="btn btn-default btn-outline-dark dropdown-toggle" aria-expanded="false" @click="${()=>this._toggleDropDown()}">${this._localization.getLabel("add.button")}</button><ul class="dropdown-menu" aria-labelledby="dropdown-btn"><li><a class="dropdown-item" href="" @click="${t=>this._addEvaluator(t,"OPERATOR")}">${this._localization.getLabel("add.operator")}</a></li><li><a class="dropdown-item" href="" @click="${t=>this._addEvaluator(t,"USER")}">${this._localization.getLabel("add.user")}</a></li><li><a class="dropdown-item" href="" @click="${t=>this._addEvaluator(t,"GROUP")}">${this._localization.getLabel("add.group")}</a></li><li><a class="dropdown-item" href="" @click="${t=>this._addEvaluator(t,"AUTH")}">${this._localization.getLabel("add.authenticatedUsers")}</a></li><li><a class="dropdown-item" href="" @click="${t=>this._addEvaluator(t,"ATTRIBUTE")}">${this._localization.getLabel("add.userAttribute")}</a></li></ul></div>${this._evaluator.evaluators&&this._evaluator.evaluators.length>0?j`<button type="button" class="btn btn-default btn-outline-dark" @click="${()=>this._deleteEvaluators()}"><span>${this._localization.getLabel("operator.removeChilds")}</span></button>`:""}</div>`}_renderDeleteEvaluator(){return j`<a class="text-danger" href="" @click="${t=>this._deleteEvaluator(t)}" data-tooltip aria-describedby="tooltip" @mouseenter="${()=>this._tooltip.showToolTip()}" @mouseleave="${()=>this._tooltip.hideToolTip()}"><i class="icon icon-remove"></i> ${this._tooltip.renderToolTip(this._localization.getLabel("delete.button"))}</a>`}_generateId(){return Date.now()}_isValidEvaluator(t){if(rt.isDefined(t)&&rt.isDefined(t.class))switch(t.class){case"OPERATOR":if(t.evaluators.length>0){for(var e=0;e<t.evaluators.length;e++)if(!this._isValidEvaluator(t.evaluators[e]))return!1;return!0}return!1;case"AUTHENTICATED":return!0;case"USERATTRIBUTES":case"USERMULTIVALUEDATTRIBUTES":return rt.isDefined(t.value)&&rt.isDefined(t.attribute)&&rt.isDefined(t.mode)&&""!==t.value&&""!==t.attribute&&""!==t.mode&&null!==t.value&&null!==t.attribute&&null!==t.mode;case"USERGROUP":return rt.isDefined(t.group)&&""!==t.group&&null!==t.group;default:return!1}return!1}_addEvaluator(t,e){switch(t.preventDefault(),t.stopPropagation(),this._toggleDropDown(),e){case"OPERATOR":this._evaluator.evaluators=this._evaluator.evaluators.concat([{class:"OPERATOR",id:null,type:"OR",evaluators:[]}]);break;case"USER":this._evaluator.evaluators=this._evaluator.evaluators.concat([{class:"USERATTRIBUTES",id:null,mode:"EQUALS",attribute:"uid",value:null}]);break;case"GROUP":this._evaluator.evaluators=this._evaluator.evaluators.concat([{class:"USERGROUP",id:null,group:null}]);break;case"AUTH":this._evaluator.evaluators=this._evaluator.evaluators.concat([{class:"AUTHENTICATED",id:null}]);break;case"ATTRIBUTE":this._evaluator.evaluators=this._evaluator.evaluators.concat([{class:"USERMULTIVALUEDATTRIBUTES",id:null,mode:this.config.stringEvaluators[0],attribute:this._userAttributes[0],value:null}])}this.requestUpdate(),this._sendEvent("childUpdate")}_deleteEvaluators(){this._evaluator.evaluators=[],this.requestUpdate(),this._sendEvent("childUpdate")}_deleteEvaluator(t){t.preventDefault(),t.stopPropagation(),this._sendEvent("childDeletion")}_onChildDeletionEvent(t){t.stopPropagation();const e=[];this._evaluator.evaluators.forEach((i=>{i!==t.detail.evaluator&&e.push(i)})),this._evaluator.evaluators=e,this.requestUpdate(),this._sendEvent("childUpdate")}_onChildUpdateEvent(t){t.stopPropagation(),this._evaluator.evaluators[t.detail.index]=t.detail.evaluator,this._sendEvent("childUpdate")}_onChangeType(t){this._evaluator.type=t,this._sendEvent("childUpdate")}_onChangeValue(t){this._evaluator.value=t,this._sendEvent("childUpdate")}_onChangeAttribute(t){this._evaluator.attribute=t,this._sendEvent("childUpdate")}_onChangeMode(t){this._evaluator.mode=t,this._sendEvent("childUpdate")}_onPersonSelection(t){t&&t.length>0&&(t[0].modelId?this._evaluator.value=t[0].modelId.keyId:t[0].extendedSubject&&(this._evaluator.value=t[0].extendedSubject.keyValue+t[0].extendedSubject.keyAttribute),this.requestUpdate(),this._sendEvent("childUpdate"))}_onGroupSelection(t){t&&t.length>0&&(t[0].modelId?this._evaluator.group=t[0].modelId.keyId:t[0].extendedSubject&&(this._evaluator.group=t[0].extendedSubject.keyValue+t[0].extendedSubject.keyAttribute),this.requestUpdate(),this._sendEvent("childUpdate"))}_toggleDropDown(){this._dropdown.querySelector(".dropdown-toggle").classList.contains("show")?this._hideDropDown():this._showDropDown()}_showDropDown(){const t=this._dropdown.querySelector(".dropdown-toggle");t.classList.contains("show")||(t.classList.add("show"),t.setAttribute("aria-expanded",!0),this._dropdown.querySelector(".dropdown-menu").style.transform="translateY("+(this._dropdown.offsetHeight+2)+"px)",this._dropdown.querySelector(".dropdown-menu").classList.add("show"))}_hideDropDown(){const t=this._dropdown.querySelector(".dropdown-toggle");t.classList.contains("show")&&(t.classList.remove("show"),t.setAttribute("aria-expanded",!1),this._dropdown.querySelector(".dropdown-menu").classList.remove("show"))}_onDropDownKeyDown(t){if(27===t.keyCode)this._hideDropDown(),this._dropdown.querySelector(".dropdown-toggle").focus(),t.preventDefault(),t.stopPropagation();else if(38===t.keyCode){if(t.target!==this._dropdown.querySelector(".dropdown-toggle")){const e=t.target.parentNode.previousElementSibling;e&&(e.childNodes[0].focus(),t.preventDefault(),t.stopPropagation())}}else if(40===t.keyCode)if(t.target!==this._dropdown.querySelector(".dropdown-toggle")){const e=t.target.parentNode.nextElementSibling;e&&(e.childNodes[0].focus(),t.preventDefault(),t.stopPropagation())}else this._showDropDown(),this._dropdown.querySelector(".dropdown-menu li:first-child").childNodes[0].focus(),t.preventDefault(),t.stopPropagation()}_onDropDownFocusOut(t){const e=this._dropdown.querySelector(".dropdown-toggle"),i=Array.from(this._dropdown.querySelectorAll(".dropdown-item"));t.relatedTarget===e||i.includes(t.relatedTarget)||this._hideDropDown()}_sendEvent(t){if(this.isChild||"childUpdate"!==t){const e={detail:{evaluator:this._evaluator},bubbles:!0,composed:!0};this.dispatchEvent(new CustomEvent(t,e))}else this.onModification&&this.onModification(this._evaluator)}}customElements.get("esup-edit-evaluator")||customElements.define("esup-edit-evaluator",$t);class xt extends J{static get properties(){return{collection:{attribute:!1},config:{attribute:!1}}}render(){return j`<ul class="edit-evaluator">${(this.collection||[]).map((t=>j`<li><esup-edit-evaluator .evaluator="${t}" .isChild="${!0}" .config="${this.config}" @childUpdate="${e=>this._onChildUpdateEvent(e,t)}"></esup-edit-evaluator></li>`))}</ul>`}_onChildUpdateEvent(t,e){t.detail.index=this.collection.indexOf(e)}}customElements.get("esup-edit-evaluators")||customElements.define("esup-edit-evaluators",xt),t.EditEvaluator=$t,t.EditEvaluators=xt,t.Evaluator=mt,t.Evaluators=ft,t.SimpleEvaluators=vt,Object.defineProperty(t,"__esModule",{value:!0})}));
