<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Esup-Publisher - JsTree</title>
    <meta name="description" content="Esup-Publisher - JsTree" />
    <link rel="stylesheet" href="./font-awesome/solid.css" />
    <script>
      if (!window.customElements) {
        document.write('<!--');
      }
    </script>
    <script src="./vendor/custom-elements-es5-adapter.js"></script>
    <!-- ! DO NOT REMOVE THIS COMMENT, WE NEED ITS CLOSING MARKER -->
  </head>

  <body>
    <header><h1>Esup-Publisher - JsTree</h1></header>
    <div>
      <button type="button" onclick="addNode()">Add node</button>
      <button type="button" onclick="selectNode('6:PUBLISHER')">Select "Direction" node</button>
      <button type="button" onclick="deleteNode('5:PUBLISHER')">Delete "Pédagogie" node</button>
      <button type="button" onclick="refreshNode()">Refresh "Actualités" children (delete last children)</button>
      <button type="button" onclick="deselectNodes()">Deselect all nodes</button>
    </div>
    <script src="./vendor/webcomponents-loader.js"></script>
    <script>
      const children = [
        {
          "id":"4:PUBLISHER",
          "text":"Vie Scolaire",
          "children":false
        },
        {
          "id":"5:PUBLISHER",
          "text":"Pédagogie",
          "children":true,
          "getChildren": () => new Promise(resolve => {
            console.log('Loading "Pédagogie" children', children)
            resolve([
              {
                "id":"7:PUBLISHER",
                "text":"Enfant 1",
                "children":false
              },
              {
                "id":"8:PUBLISHER",
                "text":"Enfant 2",
                "children":false
              }
            ])
          })
        },
        {
          "id":"6:PUBLISHER",
          "text":"Direction",
          "children":false
        }
      ];
      const datas = [
        {
          "id":"1:PUBLISHER",
          "text":"Flash-Infos",
          "children":false
        },
        {
          "id":"2:PUBLISHER",
          "text":"Actualités",
          "children":true,
          "getChildren": () => new Promise(resolve => {
            console.log('Loading "Actualités" children', children)
            resolve(children)
          })
        },
        {
          "id":"3:PUBLISHER",
          "text":"Documents",
          "children":false
        }
      ];
      const config = {
        "identifier": "tree",
        "showCheckbox": true,
        "isMultipleSelection": true
      };
      const onSelection= (res) => console.log("Selected datas : ", res);

      const tree = document.createElement('esup-js-tree');
      tree.datas = datas;
      tree.config = config;
      tree.onSelection = onSelection;

      document.body.appendChild(tree);

      addNode = () => {
        tree.addNode(null, { id:'newNode1', text: 'new node', children: false})
      };

      selectNode = (id) => {
        tree.selectNode(id)
      };

      deleteNode = (id) => {
        tree.deleteNode(id)
      };

      refreshNode = () => {
        children.splice(children.length -1)
        tree.refreshNode('2:PUBLISHER', { text: 'Actualités update'}, true)
      };

      deselectNodes = () => {
        tree.deselectAllNodes()
      };
    </script>
  </body>
</html>
